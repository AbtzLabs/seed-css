/** 
 * Seed CSS (seed-css) 
 * A light-weight, mobile first and responsive CSS boilerplate. 
 * @author Rogerio Taques (hello@abtz.co) 
 * @copyright 2016-2018, Rogerio Taques (hello@abtz.co) 
 * @license MIT 
 * @version 2.0.2 
 */ 

 "use strict";!function(){function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n}return"function"!=typeof window.CustomEvent&&(t.prototype=window.Event.prototype,void(window.CustomEvent=t))}();
"use strict";var seedFileUpload=function(){var e=function(e){e&&e.preventDefault();var t,i=!1,n=this,l=n.nextElementSibling;n.files&&n.files.length>1?i=(n.getAttribute("data-multiple")||"{count} files").replace("{count}",n.files.length):n.value.trim().length>0&&(i=n.value.split("\\").pop()),i&&(l.querySelector(".input").innerHTML=i),""!==n.value&&(t=new CustomEvent("file.chosen"),n.parentNode.classList.add("chosen"),n.dispatchEvent(t))},t=document.querySelectorAll('.seed-file > [type="file"]');null!==t&&t.forEach(function(t,i){var n=t.nextElementSibling,l=n.querySelector(".cancel"),o=t.getAttribute("data-empty")||"No file chosen";n&&(t.getAttribute("id")&&t.getAttribute("id")!==n.getAttribute("for")?n.setAttribute("for",t.getAttribute("id")):n.getAttribute("for")&&!t.getAttribute("id")?t.setAttribute("id",n.getAttribute("for")):(t.setAttribute("id","file-input-"+i),n.setAttribute("for","file-input-"+i)),l&&l.addEventListener("click",function(e){e&&e.preventDefault();var i=t.getAttribute("data-empty")||"No file chosen";t.value="",t.parentNode.classList.remove("chosen"),n.querySelector(".input").innerHTML=i,seedCustomEvent=new CustomEvent("file.removed"),t.dispatchEvent(seedCustomEvent)}),n.querySelector(".input").innerHTML=o,t.addEventListener("change",e))})};"undefined"!=typeof module?("undefined"==typeof module.exports.SeedCSS&&(module.exports.SeedCSS={}),module.exports.SeedCSS.fileUpload=seedFileUpload):("undefined"==typeof window.SeedCSS&&(window.SeedCSS={}),window.SeedCSS.fileUpload=seedFileUpload);
"use strict";var fnOpen,fnClose,fnEsc,seedModal=function(e){var n={trigger:'[role="modal"]',classAnimation:{open:"flipInX",close:"flipOutX"}};e=Object.assign({},n,e);var t=document.querySelectorAll(".modal"),o=document.querySelectorAll(e.trigger);return fnClose=function(n){if(n){var t,o=document.querySelector("html"),d=n.querySelector(".modal-window");d&&(document.removeEventListener("keydown",fnEsc),d.classList.replace(e.classAnimation.open,e.classAnimation.close),n.classList.add("delay-1s"),n.classList.replace("fadeIn","fadeOut"),setTimeout(function(){t=new CustomEvent("modal.closed"),n.dispatchEvent(t),n.classList.add("hide"),o.style.overflow="",n.classList.remove("delay-1s","fadeOut"),d.classList.replace(e.classAnimation.close,e.classAnimation.open)},600))}},fnOpen=function(n){if(n){var t,o=document.querySelector("html"),d=n.querySelector(".modal-window");fnEsc=function(e){var t=e.keyCode||e.which;27===t&&fnClose(n)},d&&(document.addEventListener("keydown",fnEsc),n.style.display="",n.classList.add("animated","fadeIn","fast"),d.classList.add("animated",e.classAnimation.open),n.classList.remove("hide"),o.style.overflow="hidden",setTimeout(function(){t=new CustomEvent("modal.opened"),n.dispatchEvent(t)},100))}},null!==t&&t.forEach(function(e,n){var t=e.querySelectorAll('[role="modal-dismiss"]');e.addEventListener("click",function(){fnClose(e)}),e.show=function(){fnOpen(e)},e.hide=function(){fnClose(e)},null!==t&&t.forEach(function(n,t){n.addEventListener("click",function(n){n&&(n.preventDefault(),n.stopPropagation()),fnClose(e)})})}),null!==o&&o.forEach(function(e,n){e.addEventListener("click",function(n){n&&n.preventDefault();var t=e.getAttribute("data-modal-id");if(null!==t){var o=document.querySelector("#".concat(t));fnOpen(o)}})}),o=void 0,{get:function(e){if("string"==typeof e){var n=!1;return t.forEach(function(t){if(t.id===e.replace(/^#/,""))return void(n=t)}),n}return"undefined"!=typeof t[e]&&t[e]}}};"undefined"!=typeof module?("undefined"==typeof module.exports.SeedCSS&&(module.exports.SeedCSS={}),module.exports.SeedCSS.modal=seedModal):("undefined"==typeof window.SeedCSS&&(window.SeedCSS={}),window.SeedCSS.modal=seedModal);
"use strict";var seedOffCanvas=function(){var e=function(e,n){var t,o=document.querySelector("#".concat(e.replace(/^#/,""))),a=n||document.querySelector('[role="offcanvas"][data-id="'.concat(e.replace(/^#/,""),'"]'));null!==o&&(o.classList.toggle("open"),o.classList.contains("open")?(null!==a&&a.classList.add("triggered"),document.querySelector("html").style.overflow="hidden"):(document.querySelectorAll('[role="offcanvas"][data-id="'.concat(e.replace(/^#/,""),'"]')).forEach(function(e){e.classList.remove("triggered")}),document.querySelector("html").style.overflow=""),setTimeout(function(){t=o.classList.contains("open")?new CustomEvent("canvas.opened"):new CustomEvent("canvas.closed"),o.dispatchEvent(t)},300))},n=function(n){n&&n.preventDefault(),e(n.currentTarget.getAttribute("data-id")||"offcanvas",n.currentTarget)},t=document.querySelectorAll('[role="offcanvas"]'),o=document.querySelectorAll(".offcanvas");return null!==t&&t.forEach(function(e,t){e.addEventListener("click",n)}),null!==o&&o.forEach(function(n,t){n.open=function(){e(n.getAttribute("id")||"offcanvas")},n.close=function(){}}),{get:function(e){if("string"==typeof e){var n=!1;return o.forEach(function(t){if(t.id===e.replace(/^#/,""))return void(n=t)}),n}return"undefined"!=typeof canvas[e]&&canvas[e]}}};"undefined"!=typeof module?("undefined"==typeof module.exports.SeedCSS&&(module.exports.SeedCSS={}),module.exports.SeedCSS.offCanvas=seedOffCanvas):("undefined"==typeof window.SeedCSS&&(window.SeedCSS={}),window.SeedCSS.offCanvas=seedOffCanvas);
"use strict";var seedScroll=function(e){var t=null,o=0,n=50,l={spyScrollContainer:"nav",spyScroll:"a.smooth",revealWhenVisible:".reveal"},r=function(e){t.forEach(function(e){e.classList.remove("active")}),e&&e.classList.add("active")},c=function(e){var t=document.body.getBoundingClientRect(),o=e.getBoundingClientRect();return{top:Math.ceil(o.top-t.top),left:Math.ceil(o.left-t.left)}},i=function(e){if(window.scrollY===o){var l=new CustomEvent("scroll.complete");document.dispatchEvent(l)}if(t){var i=c(t[0]);window.scrollY<i.top&&r(),t.forEach(function(e,t){var o=e.getAttribute("href")||e.getAttribute("data-target"),l=document.querySelector(o),i=c(l);if(i.top-n<=window.scrollY)return void r(e)})}"function"==typeof window.oldOnscroll&&window.oldOnscroll(e)},d=function(e){e&&e.preventDefault();var t=e.currentTarget.getAttribute("href")||e.currentTarget.getAttribute("data-target");if(t){var l=document.querySelector(t);o=c(l).top-n,window.scrollTo({behavior:"smooth",left:0,top:o})}};window.oldOnscroll=window.onscroll,window.onscroll=i,e=Object.assign({},l,e),t=document.querySelectorAll(e.spyScroll),null!==t&&t.forEach(function(e,t){e.addEventListener("click",d)})};"undefined"!=typeof module?("undefined"==typeof module.exports.SeedCSS&&(module.exports.SeedCSS={}),module.exports.SeedCSS.scroll=seedScroll):("undefined"==typeof window.SeedCSS&&(window.SeedCSS={}),window.SeedCSS.scroll=seedScroll);
"use strict";var seedTextarea=function(){var e=document.querySelectorAll(".field > textarea");null!==e&&e.forEach(function(e,t){var a=0,r=e.parentNode,n=r.querySelector('[role="counter"]'),d=n.getAttribute("data-template")||"Typed %a out of %b. Remaining %c.",o=function(){var t=e.value.replace(/[\n\r]/g,"").length,r=a-t,o=Math.floor(.1*a);n.innerHTML=d.replace("%a",t).replace("%b",a).replace("%c",r<=o?'<span class="red" >'.concat(r,"</span>"):r)};a=e.getAttribute("maxlength"),a&&(a=parseInt(a),"keypress keydown keyup".split(" ").forEach(function(t){e.addEventListener(t,o,!0)}),o())})};"undefined"!=typeof module?("undefined"==typeof module.exports.SeedCSS&&(module.exports.SeedCSS={}),module.exports.SeedCSS.textArea=seedTextarea):("undefined"==typeof window.SeedCSS&&(window.SeedCSS={}),window.SeedCSS.textArea=seedTextarea);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImN1c3RvbUV2ZW50UG9seWZpbGwuanMiLCJzZWVkRmlsZVVwbG9hZC5qcyIsInNlZWRNb2RhbC5qcyIsInNlZWRPZmZDYW52YXMuanMiLCJzZWVkU2Nyb2xsLmpzIiwic2VlZFRleHRhcmVhLmpzIl0sIm5hbWVzIjpbIkN1c3RvbUV2ZW50IiwiZXZlbnQiLCJwYXJhbXMiLCJidWJibGVzIiwiY2FuY2VsYWJsZSIsImRldGFpbCIsInVuZGVmaW5lZCIsImV2dCIsImRvY3VtZW50IiwiY3JlYXRlRXZlbnQiLCJpbml0Q3VzdG9tRXZlbnQiLCJ3aW5kb3ciLCJwcm90b3R5cGUiLCJFdmVudCIsInNlZWRGaWxlVXBsb2FkIiwiZm5DaGFuZ2UiLCJwcmV2ZW50RGVmYXVsdCIsInNlZWRDdXN0b21FdmVudCIsImZpbGVOYW1lIiwiaW5wdXQiLCJ0aGlzIiwibGFiZWwiLCJuZXh0RWxlbWVudFNpYmxpbmciLCJmaWxlcyIsImxlbmd0aCIsImdldEF0dHJpYnV0ZSIsInJlcGxhY2UiLCJ2YWx1ZSIsInRyaW0iLCJzcGxpdCIsInBvcCIsInF1ZXJ5U2VsZWN0b3IiLCJpbm5lckhUTUwiLCJwYXJlbnROb2RlIiwiY2xhc3NMaXN0IiwiYWRkIiwiZGlzcGF0Y2hFdmVudCIsImlucHV0cyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiaSIsImNhbmNlbCIsImVtcHR5VGV4dCIsInNldEF0dHJpYnV0ZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZW1vdmUiLCJtb2R1bGUiLCJleHBvcnRzIiwiU2VlZENTUyIsImZpbGVVcGxvYWQiLCJmbk9wZW4iLCJmbkNsb3NlIiwiZm5Fc2MiLCJzZWVkTW9kYWwiLCJvcHRpb25zIiwiZGVmYXVsdE9wdGlvbnMiLCJ0cmlnZ2VyIiwiY2xhc3NBbmltYXRpb24iLCJvcGVuIiwiY2xvc2UiLCJPYmplY3QiLCJhc3NpZ24iLCJtb2RhbHMiLCJtb2RhbFRyaWdnZXJzIiwibW9kYWxPYmplY3QiLCJjdXN0b21FdmVudCIsImh0bWwiLCJtV2luIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInNldFRpbWVvdXQiLCJzdHlsZSIsIm92ZXJmbG93IiwiZSIsImtleSIsImtleUNvZGUiLCJ3aGljaCIsImRpc3BsYXkiLCJtb2RhbCIsImRpc21pc3NhbHMiLCJzaG93IiwiaGlkZSIsImRpc21pc3MiLCJqIiwic3RvcFByb3BhZ2F0aW9uIiwicmVmIiwiY29uY2F0IiwiZ2V0IiwiaWR4Iiwibm9kZSIsImlkIiwic2VlZE9mZkNhbnZhcyIsImZuVG9nZ2xlIiwiY2FudmFzSUQiLCJ0cmlnZ2VyRWxlbWVudCIsImNhbnZhcyIsInRvZ2dsZSIsImNvbnRhaW5zIiwidGdyIiwiZm5UcmlnZ2VyQ2xpY2siLCJjdXJyZW50VGFyZ2V0IiwidHJpZ2dlcnMiLCJjYW52YXNlcyIsIm9mZkNhbnZhcyIsInNlZWRTY3JvbGwiLCJzY3JvbGxUYXJnZXQiLCJndXR0ZXIiLCJzcHlTY3JvbGxDb250YWluZXIiLCJzcHlTY3JvbGwiLCJyZXZlYWxXaGVuVmlzaWJsZSIsImZuVXBkYXRlQWN0aXZlVHJpZ2dlciIsImVsZW0iLCJlbCIsImZuR2V0T2Zmc2V0IiwiYm9keU9mZnNldCIsImJvZHkiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJvZmZzZXQiLCJ0b3AiLCJNYXRoIiwiY2VpbCIsImxlZnQiLCJmblNjcm9sbENvbXBsZXRlIiwic2Nyb2xsWSIsImZpcnN0RWxlbWVudE9mZnNldCIsInRhcmdldElEIiwidGFyZ2V0Iiwib2xkT25zY3JvbGwiLCJzY3JvbGxUbyIsImJlaGF2aW9yIiwib25zY3JvbGwiLCJzY3JvbGwiLCJzZWVkVGV4dGFyZWEiLCJtYXhMZW5ndGgiLCJwYXJlbnQiLCJjb3VudGVyTGFiZWwiLCJ0ZW1wbGF0ZSIsImZuQ2FsYyIsInR5cGVkIiwicmVtYWluaW5nIiwibWluTGVuZ3RoIiwiZmxvb3IiLCJwYXJzZUludCIsInRleHRBcmVhIl0sIm1hcHBpbmdzIjoiQUFBQSxjQUlBLFdBR0UsUUFBU0EsR0FBWUMsRUFBT0MsR0FDMUJBLEVBQVNBLElBQVlDLFNBQVMsRUFBT0MsWUFBWSxFQUFPQyxPQUFRQyxPQUNoRSxJQUFJQyxHQUFNQyxTQUFTQyxZQUFZLGNBTy9CLE9BTkFGLEdBQUlHLGdCQUNGVCxFQUNBQyxFQUFPQyxRQUNQRCxFQUFPRSxXQUNQRixFQUFPRyxRQUVGRSxFQVhULE1BQWtDLGtCQUF2QkksUUFBT1gsY0FjbEJBLEVBQVlZLFVBQVlELE9BQU9FLE1BQU1ELGVBRXJDRCxPQUFPWCxZQUFjQTtBQ3JCdkIsWUFRQSxJQUFNYyxnQkFBaUIsV0FHckIsR0FBTUMsR0FBVyxTQUFrQlIsR0FDN0JBLEdBQ0ZBLEVBQUlTLGdCQUdOLElBQUlDLEdBQ0FDLEdBQVcsRUFFVEMsRUFBUUMsS0FDUkMsRUFBUUYsRUFBTUcsa0JBR2hCSCxHQUFNSSxPQUFTSixFQUFNSSxNQUFNQyxPQUFTLEVBQ3RDTixHQUNFQyxFQUFNTSxhQUFhLGtCQUFvQixpQkFDdkNDLFFBQVEsVUFBV1AsRUFBTUksTUFBTUMsUUFJMUJMLEVBQU1RLE1BQU1DLE9BQU9KLE9BQVMsSUFDbkNOLEVBQVdDLEVBQU1RLE1BQU1FLE1BQU0sTUFBTUMsT0FHakNaLElBQ0ZHLEVBQU1VLGNBQWMsVUFBVUMsVUFBWWQsR0FHeEIsS0FBaEJDLEVBQU1RLFFBQ1JWLEVBQWtCLEdBQUlqQixhQUFZLGVBQ2xDbUIsRUFBTWMsV0FBV0MsVUFBVUMsSUFBSSxVQUMvQmhCLEVBQU1pQixjQUFjbkIsS0FLbEJvQixFQUFTN0IsU0FBUzhCLGlCQUFpQiw2QkFFMUIsUUFBWEQsR0FDRkEsRUFBT0UsUUFBUSxTQUFTcEIsRUFBT3FCLEdBRTdCLEdBQU1uQixHQUFRRixFQUFNRyxtQkFDZG1CLEVBQVNwQixFQUFNVSxjQUFjLFdBQzdCVyxFQUFZdkIsRUFBTU0sYUFBYSxlQUFpQixnQkFHakRKLEtBTUhGLEVBQU1NLGFBQWEsT0FDbkJOLEVBQU1NLGFBQWEsUUFBVUosRUFBTUksYUFBYSxPQUVoREosRUFBTXNCLGFBQWEsTUFBT3hCLEVBQU1NLGFBQWEsT0FDcENKLEVBQU1JLGFBQWEsU0FBV04sRUFBTU0sYUFBYSxNQUMxRE4sRUFBTXdCLGFBQWEsS0FBTXRCLEVBQU1JLGFBQWEsU0FFNUNOLEVBQU13QixhQUFhLEtBQU0sY0FBZ0JILEdBQ3pDbkIsRUFBTXNCLGFBQWEsTUFBTyxjQUFnQkgsSUFJeENDLEdBQ0ZBLEVBQU9HLGlCQUFpQixRQUFTLFNBQUNyQyxHQUM1QkEsR0FDRkEsRUFBSVMsZ0JBR04sSUFBTTBCLEdBQ0p2QixFQUFNTSxhQUFhLGVBQWlCLGdCQUV0Q04sR0FBTVEsTUFBUSxHQUNkUixFQUFNYyxXQUFXQyxVQUFVVyxPQUFPLFVBQ2xDeEIsRUFBTVUsY0FBYyxVQUFVQyxVQUFZVSxFQUUxQ3pCLGdCQUFrQixHQUFJakIsYUFBWSxnQkFDbENtQixFQUFNaUIsY0FBY25CLG1CQUl4QkksRUFBTVUsY0FBYyxVQUFVQyxVQUFZVSxFQUcxQ3ZCLEVBQU15QixpQkFBaUIsU0FBVTdCLE1BS2pCLG9CQUFYK0IsU0FDNkIsbUJBQTNCQSxRQUFPQyxRQUFRQyxVQUN4QkYsT0FBT0MsUUFBUUMsWUFHakJGLE9BQU9DLFFBQVFDLFFBQVFDLFdBQWFuQyxpQkFFTixtQkFBbkJILFFBQU9xQyxVQUNoQnJDLE9BQU9xQyxZQUdUckMsT0FBT3FDLFFBQVFDLFdBQWFuQztBQy9HOUIsWUFRQSxJQUFJb0MsUUFFQUMsUUFFQUMsTUFFRUMsVUFBWSxTQUFDQyxHQUlqQixHQUFNQyxJQUVKQyxRQUFTLGlCQUlUQyxnQkFDRUMsS0FBTSxVQUNOQyxNQUFPLFlBSVhMLEdBQVVNLE9BQU9DLFVBQVdOLEVBQWdCRCxFQUc1QyxJQUFJUSxHQUFTdEQsU0FBUzhCLGlCQUFpQixVQUNuQ3lCLEVBQWdCdkQsU0FBUzhCLGlCQUFpQmdCLEVBQVFFLFFBcUp0RCxPQW5KQUwsU0FBVSxTQUFDYSxHQUNULEdBQUtBLEVBQUwsQ0FJQSxHQUFJQyxHQUNFQyxFQUFPMUQsU0FBU3VCLGNBQWMsUUFDOUJvQyxFQUFPSCxFQUFZakMsY0FBYyxnQkFFbENvQyxLQUtMM0QsU0FBUzRELG9CQUFvQixVQUFXaEIsT0FHeENlLEVBQUtqQyxVQUFVUixRQUNiNEIsRUFBUUcsZUFBZUMsS0FDdkJKLEVBQVFHLGVBQWVFLE9BSXpCSyxFQUFZOUIsVUFBVUMsSUFBSSxZQUMxQjZCLEVBQVk5QixVQUFVUixRQUFRLFNBQVUsV0FJeEMyQyxXQUFXLFdBRVRKLEVBQWMsR0FBSWpFLGFBQVksZ0JBQzlCZ0UsRUFBWTVCLGNBQWM2QixHQUcxQkQsRUFBWTlCLFVBQVVDLElBQUksUUFFMUIrQixFQUFLSSxNQUFNQyxTQUFXLEdBRXRCUCxFQUFZOUIsVUFBVVcsT0FBTyxXQUFZLFdBRXpDc0IsRUFBS2pDLFVBQVVSLFFBQ2I0QixFQUFRRyxlQUFlRSxNQUN2QkwsRUFBUUcsZUFBZUMsT0FFeEIsUUFHTFIsT0FBUyxTQUFDYyxHQUNSLEdBQUtBLEVBQUwsQ0FJQSxHQUFJQyxHQUNFQyxFQUFPMUQsU0FBU3VCLGNBQWMsUUFDOUJvQyxFQUFPSCxFQUFZakMsY0FBYyxnQkFHdkNxQixPQUFRLFNBQW9Cb0IsR0FDMUIsR0FBTUMsR0FBTUQsRUFBRUUsU0FBV0YsRUFBRUcsS0FHZixNQUFSRixHQUNGdEIsUUFBUWEsSUFJUEcsSUFLTDNELFNBQVNvQyxpQkFBaUIsVUFBV1EsT0FHckNZLEVBQVlNLE1BQU1NLFFBQVUsR0FFNUJaLEVBQVk5QixVQUFVQyxJQUFJLFdBQVksU0FBVSxRQUVoRGdDLEVBQUtqQyxVQUFVQyxJQUFJLFdBQVltQixFQUFRRyxlQUFlQyxNQUV0RE0sRUFBWTlCLFVBQVVXLE9BQU8sUUFFN0JxQixFQUFLSSxNQUFNQyxTQUFXLFNBSXRCRixXQUFXLFdBRVRKLEVBQWMsR0FBSWpFLGFBQVksZ0JBQzlCZ0UsRUFBWTVCLGNBQWM2QixJQUN6QixRQUdVLE9BQVhILEdBQ0ZBLEVBQU92QixRQUFRLFNBQUNzQyxFQUFPckMsR0FFckIsR0FBTXNDLEdBQWFELEVBQU12QyxpQkFBaUIseUJBRzFDdUMsR0FBTWpDLGlCQUFpQixRQUFTLFdBQzlCTyxRQUFRMEIsS0FJVkEsRUFBTUUsS0FBTyxXQUNYN0IsT0FBTzJCLElBSVRBLEVBQU1HLEtBQU8sV0FDWDdCLFFBQVEwQixJQUdTLE9BQWZDLEdBQ0ZBLEVBQVd2QyxRQUFRLFNBQUMwQyxFQUFTQyxHQUMzQkQsRUFBUXJDLGlCQUFpQixRQUFTLFNBQUNyQyxHQUM3QkEsSUFDRkEsRUFBSVMsaUJBQ0pULEVBQUk0RSxtQkFHTmhDLFFBQVEwQixTQU9JLE9BQWxCZCxHQUNGQSxFQUFjeEIsUUFBUSxTQUFDaUIsRUFBU2hCLEdBQzlCZ0IsRUFBUVosaUJBQWlCLFFBQVMsU0FBQ3JDLEdBQzdCQSxHQUNGQSxFQUFJUyxnQkFHTixJQUFNb0UsR0FBTTVCLEVBQVEvQixhQUFhLGdCQUVqQyxJQUFZLE9BQVIyRCxFQUFjLENBQ2hCLEdBQU1QLEdBQVFyRSxTQUFTdUIsY0FBVCxJQUFBc0QsT0FBMkJELEdBQ3pDbEMsUUFBTzJCLFFBTWZkLEVBQWdCekQsUUFHZGdGLElBQUssU0FBQ0MsR0FDSixHQUFtQixnQkFBUkEsR0FBa0IsQ0FDM0IsR0FBSVYsSUFBUSxDQVNaLE9BUEFmLEdBQU92QixRQUFRLFNBQUNpRCxHQUNkLEdBQUlBLEVBQUtDLEtBQU9GLEVBQUk3RCxRQUFRLEtBQU0sSUFFaEMsWUFEQW1ELEVBQVFXLEtBS0xYLEVBR1QsTUFBMkIsbUJBQWhCZixHQUFPeUIsSUFDVHpCLEVBQU95QixLQVFBLG9CQUFYekMsU0FDNkIsbUJBQTNCQSxRQUFPQyxRQUFRQyxVQUN4QkYsT0FBT0MsUUFBUUMsWUFHakJGLE9BQU9DLFFBQVFDLFFBQVE2QixNQUFReEIsWUFFRCxtQkFBbkIxQyxRQUFPcUMsVUFDaEJyQyxPQUFPcUMsWUFHVHJDLE9BQU9xQyxRQUFRNkIsTUFBUXhCO0FDMU56QixZQVFBLElBQU1xQyxlQUFnQixXQUdwQixHQUFNQyxHQUFXLFNBQUNDLEVBQVVDLEdBQzFCLEdBQUk1QixHQUVFNkIsRUFBU3RGLFNBQVN1QixjQUFULElBQUFzRCxPQUEyQk8sRUFBU2xFLFFBQVEsS0FBTSxNQUUzRDhCLEVBQ0pxQyxHQUNBckYsU0FBU3VCLGNBQVQsK0JBQUFzRCxPQUNpQ08sRUFBU2xFLFFBQVEsS0FBTSxJQUR4RCxNQUlhLFFBQVhvRSxJQUNGQSxFQUFPNUQsVUFBVTZELE9BQU8sUUFHcEJELEVBQU81RCxVQUFVOEQsU0FBUyxTQUNaLE9BQVp4QyxHQUVGQSxFQUFRdEIsVUFBVUMsSUFBSSxhQUl4QjNCLFNBQVN1QixjQUFjLFFBQVF1QyxNQUFNQyxTQUFXLFdBR2hEL0QsU0FDRzhCLGlCQURILCtCQUFBK0MsT0FFbUNPLEVBQVNsRSxRQUFRLEtBQU0sSUFGMUQsT0FJR2EsUUFBUSxTQUFDMEQsR0FDUkEsRUFBSS9ELFVBQVVXLE9BQU8sZUFJekJyQyxTQUFTdUIsY0FBYyxRQUFRdUMsTUFBTUMsU0FBVyxJQUlsREYsV0FBVyxXQUVQSixFQURFNkIsRUFBTzVELFVBQVU4RCxTQUFTLFFBQ2QsR0FBSWhHLGFBQVksaUJBRWhCLEdBQUlBLGFBQVksaUJBSWhDOEYsRUFBTzFELGNBQWM2QixJQUNwQixPQUlEaUMsRUFBaUIsU0FBQzNGLEdBQ2xCQSxHQUNGQSxFQUFJUyxpQkFHTjJFLEVBQ0VwRixFQUFJNEYsY0FBYzFFLGFBQWEsWUFBYyxZQUM3Q2xCLEVBQUk0RixnQkFLRkMsRUFBVzVGLFNBQVM4QixpQkFBaUIsc0JBR3JDK0QsRUFBVzdGLFNBQVM4QixpQkFBaUIsYUFvQjNDLE9BbEJpQixRQUFiOEQsR0FDRkEsRUFBUzdELFFBQVEsU0FBU2lCLEVBQVNoQixHQUNqQ2dCLEVBQVFaLGlCQUFpQixRQUFTc0QsS0FJckIsT0FBYkcsR0FDRkEsRUFBUzlELFFBQVEsU0FBQ3VELEVBQVF0RCxHQUV4QnNELEVBQU9wQyxLQUFPLFdBQ1ppQyxFQUFTRyxFQUFPckUsYUFBYSxPQUFTLGNBSXhDcUUsRUFBT25DLE1BQVEsZ0JBS2pCMkIsSUFBSyxTQUFDQyxHQUNKLEdBQW1CLGdCQUFSQSxHQUFrQixDQUMzQixHQUFJTyxJQUFTLENBU2IsT0FQQU8sR0FBUzlELFFBQVEsU0FBQ2lELEdBQ2hCLEdBQUlBLEVBQUtDLEtBQU9GLEVBQUk3RCxRQUFRLEtBQU0sSUFFaEMsWUFEQW9FLEVBQVNOLEtBS05NLEVBR1QsTUFBMkIsbUJBQWhCQSxRQUFPUCxJQUNUTyxPQUFPUCxLQVFBLG9CQUFYekMsU0FDNkIsbUJBQTNCQSxRQUFPQyxRQUFRQyxVQUN4QkYsT0FBT0MsUUFBUUMsWUFHakJGLE9BQU9DLFFBQVFDLFFBQVFzRCxVQUFZWixnQkFFTCxtQkFBbkIvRSxRQUFPcUMsVUFDaEJyQyxPQUFPcUMsWUFHVHJDLE9BQU9xQyxRQUFRc0QsVUFBWVo7QUNwSTdCLFlBUUEsSUFBTWEsWUFBYSxTQUFTakQsR0FHMUIsR0FBSThDLEdBQVcsS0FFWEksRUFBZSxFQUViQyxFQUFTLEdBRVRsRCxHQUNKbUQsbUJBQW9CLE1BQ3BCQyxVQUFXLFdBQ1hDLGtCQUFtQixXQUdmQyxFQUF3QixTQUFDQyxHQUM3QlYsRUFBUzdELFFBQVEsU0FBQ3dFLEdBQ2hCQSxFQUFHN0UsVUFBVVcsT0FBTyxZQUdsQmlFLEdBQ0ZBLEVBQUs1RSxVQUFVQyxJQUFJLFdBSWpCNkUsRUFBYyxTQUFDRixHQUNuQixHQUFNRyxHQUFhekcsU0FBUzBHLEtBQUtDLHdCQUMzQkMsRUFBU04sRUFBS0ssdUJBRXBCLFFBQ0VFLElBQUtDLEtBQUtDLEtBQUtILEVBQU9DLElBQU1KLEVBQVdJLEtBQ3ZDRyxLQUFNRixLQUFLQyxLQUFLSCxFQUFPSSxLQUFPUCxFQUFXTyxRQUl2Q0MsRUFBbUIsU0FBQ2xILEdBQ3hCLEdBQUlJLE9BQU8rRyxVQUFZbEIsRUFBYyxDQUNuQyxHQUFNdkYsR0FBa0IsR0FBSWpCLGFBQVksa0JBQ3hDUSxVQUFTNEIsY0FBY25CLEdBR3pCLEdBQUltRixFQUFVLENBQ1osR0FBTXVCLEdBQXFCWCxFQUFZWixFQUFTLEdBRTVDekYsUUFBTytHLFFBQVVDLEVBQW1CTixLQUN0Q1IsSUFHRlQsRUFBUzdELFFBQVEsU0FBQ3dFLEVBQUl2RSxHQUNwQixHQUFNb0YsR0FDSmIsRUFBR3RGLGFBQWEsU0FBV3NGLEVBQUd0RixhQUFhLGVBRXZDb0csRUFBU3JILFNBQVN1QixjQUFjNkYsR0FDaENSLEVBQVNKLEVBQVlhLEVBRTNCLElBQUlULEVBQU9DLElBQU1aLEdBQVU5RixPQUFPK0csUUFFaEMsV0FEQWIsR0FBc0JFLEtBTU0sa0JBQXZCcEcsUUFBT21ILGFBQ2hCbkgsT0FBT21ILFlBQVl2SCxJQUlqQjJGLEVBQWlCLFNBQUMzRixHQUNsQkEsR0FDRkEsRUFBSVMsZ0JBR04sSUFBTTZHLEdBQ0p0SCxFQUFJNEYsY0FBYzFFLGFBQWEsU0FDL0JsQixFQUFJNEYsY0FBYzFFLGFBQWEsY0FFakMsSUFBSW9HLEVBQVEsQ0FDVixHQUFNZixHQUFPdEcsU0FBU3VCLGNBQWM4RixFQUVwQ3JCLEdBQWVRLEVBQVlGLEdBQU1PLElBQU1aLEVBRXZDOUYsT0FBT29ILFVBQ0xDLFNBQVUsU0FDVlIsS0FBTSxFQUNOSCxJQUFLYixLQUtYN0YsUUFBT21ILFlBQWNuSCxPQUFPc0gsU0FDNUJ0SCxPQUFPc0gsU0FBV1IsRUFFbEJuRSxFQUFVTSxPQUFPQyxVQUFXTixFQUFnQkQsR0FHNUM4QyxFQUFXNUYsU0FBUzhCLGlCQUFpQmdCLEVBQVFxRCxXQUU1QixPQUFiUCxHQUNGQSxFQUFTN0QsUUFBUSxTQUFTaUIsRUFBU2hCLEdBQ2pDZ0IsRUFBUVosaUJBQWlCLFFBQVNzRCxLQU9sQixvQkFBWHBELFNBQzZCLG1CQUEzQkEsUUFBT0MsUUFBUUMsVUFDeEJGLE9BQU9DLFFBQVFDLFlBR2pCRixPQUFPQyxRQUFRQyxRQUFRa0YsT0FBUzNCLGFBRUYsbUJBQW5CNUYsUUFBT3FDLFVBQ2hCckMsT0FBT3FDLFlBR1RyQyxPQUFPcUMsUUFBUWtGLE9BQVMzQjtBQzdIMUIsWUFRQSxJQUFNNEIsY0FBZSxXQUluQixHQUFNOUYsR0FBUzdCLFNBQVM4QixpQkFBaUIsb0JBRTFCLFFBQVhELEdBQ0ZBLEVBQU9FLFFBQVEsU0FBU3BCLEVBQU9xQixHQUM3QixHQUFJNEYsR0FBWSxFQUVWQyxFQUFTbEgsRUFBTWMsV0FDZnFHLEVBQWVELEVBQU90RyxjQUFjLG9CQUNwQ3dHLEVBQ0pELEVBQWE3RyxhQUFhLGtCQUMxQixvQ0FFSStHLEVBQVMsV0FDYixHQUFNQyxHQUFRdEgsRUFBTVEsTUFBTUQsUUFBUSxVQUFXLElBQUlGLE9BQzNDa0gsRUFBWU4sRUFBWUssRUFDeEJFLEVBQVlyQixLQUFLc0IsTUFBa0IsR0FBWlIsRUFFN0JFLEdBQWF0RyxVQUFZdUcsRUFDdEI3RyxRQUFRLEtBQU0rRyxHQUNkL0csUUFBUSxLQUFNMEcsR0FDZDFHLFFBQ0MsS0FDQWdILEdBQWFDLEVBQWIsc0JBQUF0RCxPQUMwQnFELEVBRDFCLFdBRUlBLEdBSVZOLEdBQVlqSCxFQUFNTSxhQUFhLGFBRzFCMkcsSUFLTEEsRUFBWVMsU0FBU1QsR0FHckIseUJBQXlCdkcsTUFBTSxLQUFLVSxRQUFRLFNBQUNoQyxHQUMzQ1ksRUFBTXlCLGlCQUFpQnJDLEVBQUtpSSxHQUFRLEtBSXRDQSxPQUtnQixvQkFBWDFGLFNBQzZCLG1CQUEzQkEsUUFBT0MsUUFBUUMsVUFDeEJGLE9BQU9DLFFBQVFDLFlBR2pCRixPQUFPQyxRQUFRQyxRQUFROEYsU0FBV1gsZUFFSixtQkFBbkJ4SCxRQUFPcUMsVUFDaEJyQyxPQUFPcUMsWUFHVHJDLE9BQU9xQyxRQUFROEYsU0FBV1giLCJmaWxlIjoic2VlZGNzcy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKiFcbiAqIEEgc2ltcGxlIHBvbHlmaWxsIGZvciBDdXN0b21FdmVudFxuICogQHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvQ3VzdG9tRXZlbnQvQ3VzdG9tRXZlbnQjUG9seWZpbGxcbiAqL1xuKGZ1bmN0aW9uKCkge1xuICBpZiAodHlwZW9mIHdpbmRvdy5DdXN0b21FdmVudCA9PT0gJ2Z1bmN0aW9uJykgcmV0dXJuIGZhbHNlO1xuXG4gIGZ1bmN0aW9uIEN1c3RvbUV2ZW50KGV2ZW50LCBwYXJhbXMpIHtcbiAgICBwYXJhbXMgPSBwYXJhbXMgfHwgeyBidWJibGVzOiBmYWxzZSwgY2FuY2VsYWJsZTogZmFsc2UsIGRldGFpbDogdW5kZWZpbmVkIH07XG4gICAgdmFyIGV2dCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdDdXN0b21FdmVudCcpO1xuICAgIGV2dC5pbml0Q3VzdG9tRXZlbnQoXG4gICAgICBldmVudCxcbiAgICAgIHBhcmFtcy5idWJibGVzLFxuICAgICAgcGFyYW1zLmNhbmNlbGFibGUsXG4gICAgICBwYXJhbXMuZGV0YWlsXG4gICAgKTtcbiAgICByZXR1cm4gZXZ0O1xuICB9XG5cbiAgQ3VzdG9tRXZlbnQucHJvdG90eXBlID0gd2luZG93LkV2ZW50LnByb3RvdHlwZTtcblxuICB3aW5kb3cuQ3VzdG9tRXZlbnQgPSBDdXN0b21FdmVudDtcbn0pKCk7XG4iLCIvKiohXG4gKiBTZWVkLUNTUyAtIEN1c3RvbSBIVE1MIElucHV0IEZpbGUuXG4gKiBAYXV0aG9yIFJvZ2VyaW8gVGFxdWVzIChoZWxsb0BhYnR6LmNvKVxuICogQHNlZSBodHRwczovL2dpdGh1Yi5jb20vQWJ0ekxhYnMvc2VlZC1jc3NcbiAqIEB2ZXJzaW9uIDIuMC4xXG4gKiBAbGljZW5zZSBNSVRcbiAqL1xuXG5jb25zdCBzZWVkRmlsZVVwbG9hZCA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgY29uc3QgZm5DaGFuZ2UgPSBmdW5jdGlvbiBmbkNoYW5nZShldnQpIHtcbiAgICBpZiAoZXZ0KSB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG5cbiAgICBsZXQgc2VlZEN1c3RvbUV2ZW50O1xuICAgIGxldCBmaWxlTmFtZSA9IGZhbHNlO1xuXG4gICAgY29uc3QgaW5wdXQgPSB0aGlzO1xuICAgIGNvbnN0IGxhYmVsID0gaW5wdXQubmV4dEVsZW1lbnRTaWJsaW5nO1xuXG4gICAgLy8gV2hlbiBtdWx0aXBsZSBmaWxlcyBhcmUgc2VsZWN0ZWRcbiAgICBpZiAoaW5wdXQuZmlsZXMgJiYgaW5wdXQuZmlsZXMubGVuZ3RoID4gMSkge1xuICAgICAgZmlsZU5hbWUgPSAoXG4gICAgICAgIGlucHV0LmdldEF0dHJpYnV0ZSgnZGF0YS1tdWx0aXBsZScpIHx8ICd7Y291bnR9IGZpbGVzJ1xuICAgICAgKS5yZXBsYWNlKCd7Y291bnR9JywgaW5wdXQuZmlsZXMubGVuZ3RoKTtcbiAgICB9XG5cbiAgICAvLyBXaGVuIG9ubHkgb25lIGZpbGUgaXMgc2VsZWN0ZWRcbiAgICBlbHNlIGlmIChpbnB1dC52YWx1ZS50cmltKCkubGVuZ3RoID4gMCkge1xuICAgICAgZmlsZU5hbWUgPSBpbnB1dC52YWx1ZS5zcGxpdCgnXFxcXCcpLnBvcCgpO1xuICAgIH1cblxuICAgIGlmIChmaWxlTmFtZSkge1xuICAgICAgbGFiZWwucXVlcnlTZWxlY3RvcignLmlucHV0JykuaW5uZXJIVE1MID0gZmlsZU5hbWU7XG4gICAgfVxuXG4gICAgaWYgKGlucHV0LnZhbHVlICE9PSAnJykge1xuICAgICAgc2VlZEN1c3RvbUV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KCdmaWxlLmNob3NlbicpO1xuICAgICAgaW5wdXQucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdjaG9zZW4nKTtcbiAgICAgIGlucHV0LmRpc3BhdGNoRXZlbnQoc2VlZEN1c3RvbUV2ZW50KTtcbiAgICB9XG4gIH07IC8vIGZuQ2hhbmdlXG5cbiAgLy8gRmluZCBhbGwgc2VlZC1maWxlIGlucHV0cy5cbiAgY29uc3QgaW5wdXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNlZWQtZmlsZSA+IFt0eXBlPVwiZmlsZVwiXScpO1xuXG4gIGlmIChpbnB1dHMgIT09IG51bGwpIHtcbiAgICBpbnB1dHMuZm9yRWFjaChmdW5jdGlvbihpbnB1dCwgaSkge1xuICAgICAgLy8gRmluZCB0aGUgZmllbGQgbGFiZWxcbiAgICAgIGNvbnN0IGxhYmVsID0gaW5wdXQubmV4dEVsZW1lbnRTaWJsaW5nO1xuICAgICAgY29uc3QgY2FuY2VsID0gbGFiZWwucXVlcnlTZWxlY3RvcignLmNhbmNlbCcpO1xuICAgICAgY29uc3QgZW1wdHlUZXh0ID0gaW5wdXQuZ2V0QXR0cmlidXRlKCdkYXRhLWVtcHR5JykgfHwgJ05vIGZpbGUgY2hvc2VuJztcblxuICAgICAgLy8gSWYgbGFiZWwgZG9lcyBub3QgZXhpc3RzLCBzaW1wbHkgZG8gbm90IHNldCBpdCB1cFxuICAgICAgaWYgKCFsYWJlbCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIE1ha2Ugc3VyZSBpbnB1dCBhbmQgbGFiZWwgbWF0Y2hlcyBhbmQgd29ya3MuXG4gICAgICBpZiAoXG4gICAgICAgIGlucHV0LmdldEF0dHJpYnV0ZSgnaWQnKSAmJlxuICAgICAgICBpbnB1dC5nZXRBdHRyaWJ1dGUoJ2lkJykgIT09IGxhYmVsLmdldEF0dHJpYnV0ZSgnZm9yJylcbiAgICAgICkge1xuICAgICAgICBsYWJlbC5zZXRBdHRyaWJ1dGUoJ2ZvcicsIGlucHV0LmdldEF0dHJpYnV0ZSgnaWQnKSk7XG4gICAgICB9IGVsc2UgaWYgKGxhYmVsLmdldEF0dHJpYnV0ZSgnZm9yJykgJiYgIWlucHV0LmdldEF0dHJpYnV0ZSgnaWQnKSkge1xuICAgICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoJ2lkJywgbGFiZWwuZ2V0QXR0cmlidXRlKCdmb3InKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoJ2lkJywgJ2ZpbGUtaW5wdXQtJyArIGkpO1xuICAgICAgICBsYWJlbC5zZXRBdHRyaWJ1dGUoJ2ZvcicsICdmaWxlLWlucHV0LScgKyBpKTtcbiAgICAgIH1cblxuICAgICAgLy8gQWx3YXlzIHRoZSBjYW5jZWwgYnV0dG9uIGV4aXN0cywgYWRkcyBhIGhhbmRsZXJcbiAgICAgIGlmIChjYW5jZWwpIHtcbiAgICAgICAgY2FuY2VsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2dCkgPT4ge1xuICAgICAgICAgIGlmIChldnQpIHtcbiAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IGVtcHR5VGV4dCA9XG4gICAgICAgICAgICBpbnB1dC5nZXRBdHRyaWJ1dGUoJ2RhdGEtZW1wdHknKSB8fCAnTm8gZmlsZSBjaG9zZW4nO1xuXG4gICAgICAgICAgaW5wdXQudmFsdWUgPSAnJztcbiAgICAgICAgICBpbnB1dC5wYXJlbnROb2RlLmNsYXNzTGlzdC5yZW1vdmUoJ2Nob3NlbicpO1xuICAgICAgICAgIGxhYmVsLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dCcpLmlubmVySFRNTCA9IGVtcHR5VGV4dDtcblxuICAgICAgICAgIHNlZWRDdXN0b21FdmVudCA9IG5ldyBDdXN0b21FdmVudCgnZmlsZS5yZW1vdmVkJyk7XG4gICAgICAgICAgaW5wdXQuZGlzcGF0Y2hFdmVudChzZWVkQ3VzdG9tRXZlbnQpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgbGFiZWwucXVlcnlTZWxlY3RvcignLmlucHV0JykuaW5uZXJIVE1MID0gZW1wdHlUZXh0O1xuXG4gICAgICAvLyBTdGFydCBsaXN0ZW5pbmcgdGhlIGZpZWxkIGZvciBjaGFuZ2VzXG4gICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmbkNoYW5nZSk7XG4gICAgfSk7IC8vIGlucHV0cy5mb3JFYWNoKGZ1bmN0aW9uKGlucHV0LCBpKVxuICB9IC8vIGlmIChpbnB1dHMgIT09IG51bGwpXG59OyAvLyBzZWVkRmlsZVVwbG9hZFxuXG5pZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgaWYgKHR5cGVvZiBtb2R1bGUuZXhwb3J0cy5TZWVkQ1NTID09PSAndW5kZWZpbmVkJykge1xuICAgIG1vZHVsZS5leHBvcnRzLlNlZWRDU1MgPSB7fTtcbiAgfVxuXG4gIG1vZHVsZS5leHBvcnRzLlNlZWRDU1MuZmlsZVVwbG9hZCA9IHNlZWRGaWxlVXBsb2FkO1xufSBlbHNlIHtcbiAgaWYgKHR5cGVvZiB3aW5kb3cuU2VlZENTUyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICB3aW5kb3cuU2VlZENTUyA9IHt9O1xuICB9XG5cbiAgd2luZG93LlNlZWRDU1MuZmlsZVVwbG9hZCA9IHNlZWRGaWxlVXBsb2FkO1xufVxuIiwiLyoqIVxuICogU2VlZC1DU1MgLSBNb2RhbFxuICogQGF1dGhvciBSb2dlcmlvIFRhcXVlcyAoaGVsbG9AYWJ0ei5jbylcbiAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL0FidHpMYWJzL3NlZWQtY3NzXG4gKiBAdmVyc2lvbiAyLjAuMVxuICogQGxpY2Vuc2UgTUlUXG4gKi9cblxubGV0IGZuT3BlbjtcblxubGV0IGZuQ2xvc2U7XG5cbmxldCBmbkVzYztcblxuY29uc3Qgc2VlZE1vZGFsID0gKG9wdGlvbnMpID0+IHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIC8vIERlZmF1bHQgc2V0dGluZ3NcbiAgY29uc3QgZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgLy8gdGhlIGVsZW1lbnQgdGhhdCB0cmlnZ2VycyB0aGUgbW9kYWxcbiAgICB0cmlnZ2VyOiAnW3JvbGU9XCJtb2RhbFwiXScsXG5cbiAgICAvLyBAc2VlOiBodHRwczovL2RhbmVkZW4uZ2l0aHViLmlvL2FuaW1hdGUuY3NzL1xuICAgIC8vIGFuaW1hdGUuY3NzIGNsYXNzZXMgdG8gYmUgdXNlZFxuICAgIGNsYXNzQW5pbWF0aW9uOiB7XG4gICAgICBvcGVuOiAnZmxpcEluWCcsXG4gICAgICBjbG9zZTogJ2ZsaXBPdXRYJ1xuICAgIH1cbiAgfTtcblxuICBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xuXG4gIC8vIEdldCBlbGVtZW50c1xuICBsZXQgbW9kYWxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1vZGFsJyk7XG4gIGxldCBtb2RhbFRyaWdnZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChvcHRpb25zLnRyaWdnZXIpO1xuXG4gIGZuQ2xvc2UgPSAobW9kYWxPYmplY3QpID0+IHtcbiAgICBpZiAoIW1vZGFsT2JqZWN0KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IGN1c3RvbUV2ZW50O1xuICAgIGNvbnN0IGh0bWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdodG1sJyk7XG4gICAgY29uc3QgbVdpbiA9IG1vZGFsT2JqZWN0LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbC13aW5kb3cnKTtcblxuICAgIGlmICghbVdpbikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFJlbW92ZXMgdGhlIEVTQyBsaXN0ZW5lclxuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBmbkVzYyk7XG5cbiAgICAvLyBSZXBsYWNlIG9wZW4gYW5pbWF0aW9uIHRvIGNsb3NlIHRoZSBtb2RhbCB3aW5kb3dcbiAgICBtV2luLmNsYXNzTGlzdC5yZXBsYWNlKFxuICAgICAgb3B0aW9ucy5jbGFzc0FuaW1hdGlvbi5vcGVuLFxuICAgICAgb3B0aW9ucy5jbGFzc0FuaW1hdGlvbi5jbG9zZVxuICAgICk7XG5cbiAgICAvLyBBZGQgYW5pbWF0aW9uIHRvIHRoZSBvdmVybGF5XG4gICAgbW9kYWxPYmplY3QuY2xhc3NMaXN0LmFkZCgnZGVsYXktMXMnKTtcbiAgICBtb2RhbE9iamVjdC5jbGFzc0xpc3QucmVwbGFjZSgnZmFkZUluJywgJ2ZhZGVPdXQnKTtcblxuICAgIC8vIFdhaXQgMiBzZWNvbmRzIGJlZm9yZSBjb21wbGV0ZSBkZSBwcm9jZXNzLlxuICAgIC8vIFRoaXMgaXMgdGhlIHRpbWUgdG8gZmluaXNoaW5nIGFsbCBhbmltYXRlLmNzcyBhbmltYXRpb25zXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAvLyBEaXNwYXRjaCB0aGUgJ21vZGFsLmNsb3NlZCcgZXZlbnRcbiAgICAgIGN1c3RvbUV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KCdtb2RhbC5jbG9zZWQnKTtcbiAgICAgIG1vZGFsT2JqZWN0LmRpc3BhdGNoRXZlbnQoY3VzdG9tRXZlbnQpO1xuXG4gICAgICAvLyBDb21wbGV0ZWx5IGhpZGUgdGhlIGNvbXBvbmVudFxuICAgICAgbW9kYWxPYmplY3QuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgICAgLy8gUmVlbmFibGUgc2Nyb2xsaW5nIGZyb20gdGhlIEhUTUxcbiAgICAgIGh0bWwuc3R5bGUub3ZlcmZsb3cgPSAnJztcbiAgICAgIC8vIFJlbW92ZSBjbG9zaW5nIGNsYXNzZXMgZnJvbSBvdmVybGF5XG4gICAgICBtb2RhbE9iamVjdC5jbGFzc0xpc3QucmVtb3ZlKCdkZWxheS0xcycsICdmYWRlT3V0Jyk7XG4gICAgICAvLyBSZW1vdmUgY2xvc2luZyBjbGFzc2VzIGZyb20gbW9kYWwgd2luZG93XG4gICAgICBtV2luLmNsYXNzTGlzdC5yZXBsYWNlKFxuICAgICAgICBvcHRpb25zLmNsYXNzQW5pbWF0aW9uLmNsb3NlLFxuICAgICAgICBvcHRpb25zLmNsYXNzQW5pbWF0aW9uLm9wZW5cbiAgICAgICk7XG4gICAgfSwgNjAwKTtcbiAgfTsgLy8gZm5DbG9zZVxuXG4gIGZuT3BlbiA9IChtb2RhbE9iamVjdCkgPT4ge1xuICAgIGlmICghbW9kYWxPYmplY3QpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgY3VzdG9tRXZlbnQ7XG4gICAgY29uc3QgaHRtbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2h0bWwnKTtcbiAgICBjb25zdCBtV2luID0gbW9kYWxPYmplY3QucXVlcnlTZWxlY3RvcignLm1vZGFsLXdpbmRvdycpO1xuXG4gICAgLy8gSGFuZGxlIHRoZSBFU0MgZGlzbWlzc1xuICAgIGZuRXNjID0gZnVuY3Rpb24gZXNjSGFuZGxlcihlKSB7XG4gICAgICBjb25zdCBrZXkgPSBlLmtleUNvZGUgfHwgZS53aGljaDtcblxuICAgICAgLy8gV2hlbiB0aGUgRVNDIGtleSBpcyBwcmVzc2VkXG4gICAgICBpZiAoa2V5ID09PSAyNykge1xuICAgICAgICBmbkNsb3NlKG1vZGFsT2JqZWN0KTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgaWYgKCFtV2luKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gQWRkIChhbmQgcmVtb3ZlKSBhbiBFU0MgaGFuZGxlciBmb3IgdGhlIG92ZXJsYXlcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZm5Fc2MpO1xuXG4gICAgLy8gQ2xlYXIgaW5saW5lIGRpc3BsYXkgc3R5bGUsIGlmIGFueVxuICAgIG1vZGFsT2JqZWN0LnN0eWxlLmRpc3BsYXkgPSAnJztcbiAgICAvLyBBZGQgYW5pbWF0aW9uIHRvIHRoZSBvdmVybGF5XG4gICAgbW9kYWxPYmplY3QuY2xhc3NMaXN0LmFkZCgnYW5pbWF0ZWQnLCAnZmFkZUluJywgJ2Zhc3QnKTtcbiAgICAvLyBBZGQgYW5pbWF0aW9uIHRvIHRoZSBtb2RhbCB3aW5kb3dcbiAgICBtV2luLmNsYXNzTGlzdC5hZGQoJ2FuaW1hdGVkJywgb3B0aW9ucy5jbGFzc0FuaW1hdGlvbi5vcGVuKTtcbiAgICAvLyBTaG93IHRoZSBjb21wb25lbnRcbiAgICBtb2RhbE9iamVjdC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgLy8gRmluYWxseSBwcmV2ZW50IHNjcm9sbGluZ1xuICAgIGh0bWwuc3R5bGUub3ZlcmZsb3cgPSAnaGlkZGVuJztcblxuICAgIC8vIFdhaXQgdGhlIGFuaW1hdGlvbiBjb21wbGV0ZSB0byBkaXNwYXRjaCB0aGUgZXZlbnRcbiAgICAvLyBFYWNoIGFuaW1hdGUuY3NzIGFuaW1hdGlvbiB0YWtlcyAxc1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgLy8gRGlzcGF0Y2ggdGhlICdtb2RhbC5vcGVuZWQnIGV2ZW50XG4gICAgICBjdXN0b21FdmVudCA9IG5ldyBDdXN0b21FdmVudCgnbW9kYWwub3BlbmVkJyk7XG4gICAgICBtb2RhbE9iamVjdC5kaXNwYXRjaEV2ZW50KGN1c3RvbUV2ZW50KTtcbiAgICB9LCAxMDApO1xuICB9OyAvLyBmbk9wZW5cblxuICBpZiAobW9kYWxzICE9PSBudWxsKSB7XG4gICAgbW9kYWxzLmZvckVhY2goKG1vZGFsLCBpKSA9PiB7XG4gICAgICAvLyBIYW5kbGUgdGhlIGRpc21pc3MgYnV0dG9uc1xuICAgICAgY29uc3QgZGlzbWlzc2FscyA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tyb2xlPVwibW9kYWwtZGlzbWlzc1wiXScpO1xuXG4gICAgICAvLyBBZGQgKGFuZCByZW1vdmUpIGEgY2xpY2sgaGFuZGxlciBvbiB0aGUgb3ZlcmxheVxuICAgICAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgIGZuQ2xvc2UobW9kYWwpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIEFkZCBwcm90b3R5cGUgZm9yIHNob3cgKG9wZW4pXG4gICAgICBtb2RhbC5zaG93ID0gKCkgPT4ge1xuICAgICAgICBmbk9wZW4obW9kYWwpO1xuICAgICAgfTtcblxuICAgICAgLy8gQWRkIHByb3RvdHlwZSBmb3IgaGlkZSAoY2xvZGUpXG4gICAgICBtb2RhbC5oaWRlID0gKCkgPT4ge1xuICAgICAgICBmbkNsb3NlKG1vZGFsKTtcbiAgICAgIH07XG5cbiAgICAgIGlmIChkaXNtaXNzYWxzICE9PSBudWxsKSB7XG4gICAgICAgIGRpc21pc3NhbHMuZm9yRWFjaCgoZGlzbWlzcywgaikgPT4ge1xuICAgICAgICAgIGRpc21pc3MuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZ0KSA9PiB7XG4gICAgICAgICAgICBpZiAoZXZ0KSB7XG4gICAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZuQ2xvc2UobW9kYWwpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0gLy8gaWYgKGRpc21pc3NhbHMgIT09IG51bGwpXG4gICAgfSk7XG4gIH0gLy8gaWYgKG1vZGFscyAhPT0gbnVsbClcblxuICBpZiAobW9kYWxUcmlnZ2VycyAhPT0gbnVsbCkge1xuICAgIG1vZGFsVHJpZ2dlcnMuZm9yRWFjaCgodHJpZ2dlciwgaSkgPT4ge1xuICAgICAgdHJpZ2dlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldnQpID0+IHtcbiAgICAgICAgaWYgKGV2dCkge1xuICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcmVmID0gdHJpZ2dlci5nZXRBdHRyaWJ1dGUoJ2RhdGEtbW9kYWwtaWQnKTtcblxuICAgICAgICBpZiAocmVmICE9PSBudWxsKSB7XG4gICAgICAgICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjJHtyZWZ9YCk7XG4gICAgICAgICAgZm5PcGVuKG1vZGFsKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0gLy8gaWYgKG1vZGFsVHJpZ2dlcnMgIT09IG51bGwpXG5cbiAgbW9kYWxUcmlnZ2VycyA9IHVuZGVmaW5lZDtcblxuICByZXR1cm4ge1xuICAgIGdldDogKGlkeCkgPT4ge1xuICAgICAgaWYgKHR5cGVvZiBpZHggPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGxldCBtb2RhbCA9IGZhbHNlO1xuXG4gICAgICAgIG1vZGFscy5mb3JFYWNoKChub2RlKSA9PiB7XG4gICAgICAgICAgaWYgKG5vZGUuaWQgPT09IGlkeC5yZXBsYWNlKC9eIy8sICcnKSkge1xuICAgICAgICAgICAgbW9kYWwgPSBub2RlO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIG1vZGFsO1xuICAgICAgfVxuXG4gICAgICBpZiAodHlwZW9mIG1vZGFsc1tpZHhdICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICByZXR1cm4gbW9kYWxzW2lkeF07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH07XG59OyAvLyBzZWVkTW9kYWxcblxuaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSB7XG4gIGlmICh0eXBlb2YgbW9kdWxlLmV4cG9ydHMuU2VlZENTUyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBtb2R1bGUuZXhwb3J0cy5TZWVkQ1NTID0ge307XG4gIH1cblxuICBtb2R1bGUuZXhwb3J0cy5TZWVkQ1NTLm1vZGFsID0gc2VlZE1vZGFsO1xufSBlbHNlIHtcbiAgaWYgKHR5cGVvZiB3aW5kb3cuU2VlZENTUyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICB3aW5kb3cuU2VlZENTUyA9IHt9O1xuICB9XG5cbiAgd2luZG93LlNlZWRDU1MubW9kYWwgPSBzZWVkTW9kYWw7XG59XG4iLCIvKiohXG4gKiBTZWVkLUNTUyAtIE9mZi1DYW52YXMuXG4gKiBAYXV0aG9yIFJvZ2VyaW8gVGFxdWVzIChoZWxsb0BhYnR6LmNvKVxuICogQHNlZSBodHRwczovL2dpdGh1Yi5jb20vQWJ0ekxhYnMvc2VlZC1jc3NcbiAqIEB2ZXJzaW9uIDIuMC4xXG4gKiBAbGljZW5zZSBNSVRcbiAqL1xuXG5jb25zdCBzZWVkT2ZmQ2FudmFzID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBjb25zdCBmblRvZ2dsZSA9IChjYW52YXNJRCwgdHJpZ2dlckVsZW1lbnQpID0+IHtcbiAgICBsZXQgY3VzdG9tRXZlbnQ7XG5cbiAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjJHtjYW52YXNJRC5yZXBsYWNlKC9eIy8sICcnKX1gKTtcblxuICAgIGNvbnN0IHRyaWdnZXIgPVxuICAgICAgdHJpZ2dlckVsZW1lbnQgfHxcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgIGBbcm9sZT1cIm9mZmNhbnZhc1wiXVtkYXRhLWlkPVwiJHtjYW52YXNJRC5yZXBsYWNlKC9eIy8sICcnKX1cIl1gXG4gICAgICApO1xuXG4gICAgaWYgKGNhbnZhcyAhPT0gbnVsbCkge1xuICAgICAgY2FudmFzLmNsYXNzTGlzdC50b2dnbGUoJ29wZW4nKTtcblxuICAgICAgLy8gUHJldmVudHMgc2Nyb2xsaW5nIHRoZSBIVE1MXG4gICAgICBpZiAoY2FudmFzLmNsYXNzTGlzdC5jb250YWlucygnb3BlbicpKSB7XG4gICAgICAgIGlmICh0cmlnZ2VyICE9PSBudWxsKSB7XG4gICAgICAgICAgLy8gQWRkIHRoZSAndHJpZ2dlcmVkJyBjbGFzcyB0byB0aGUgZWxlbWVudCB3aGljaCBoYXMgdHJpZ2dlcmVkIHRoZSBvZmZjYW52YXMuXG4gICAgICAgICAgdHJpZ2dlci5jbGFzc0xpc3QuYWRkKCd0cmlnZ2VyZWQnKTtcbiAgICAgICAgfSAvLyBpZiAodHJpZ2dlciAhPT0gbnVsbClcblxuICAgICAgICAvLyBQcmV2ZW50cyBtYWluIHRvIHNjcm9sbFxuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdodG1sJykuc3R5bGUub3ZlcmZsb3cgPSAnaGlkZGVuJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFJlbW92ZSB0aGUgJ3RyaWdnZXJlZCcgY2xhc3MgZm9yIGFueSBleGlzdGluZyB0cmlnZ2VyIHdoaWNoIHJlZmVycyBnaXZlbiBvZmZjYW52YXMuXG4gICAgICAgIGRvY3VtZW50XG4gICAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoXG4gICAgICAgICAgICBgW3JvbGU9XCJvZmZjYW52YXNcIl1bZGF0YS1pZD1cIiR7Y2FudmFzSUQucmVwbGFjZSgvXiMvLCAnJyl9XCJdYFxuICAgICAgICAgIClcbiAgICAgICAgICAuZm9yRWFjaCgodGdyKSA9PiB7XG4gICAgICAgICAgICB0Z3IuY2xhc3NMaXN0LnJlbW92ZSgndHJpZ2dlcmVkJyk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gUmUtZW5hYmxlcyBtYWluIHNjcm9sbGluZ1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdodG1sJykuc3R5bGUub3ZlcmZsb3cgPSAnJztcbiAgICAgIH1cblxuICAgICAgLy8gV2FpdCB1bnRpbCBhbmltYXRpb24gaXMgY29tcGxldGUgdG8gZGlzcGF0Y2ggdGhlIGV2ZW50XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgaWYgKGNhbnZhcy5jbGFzc0xpc3QuY29udGFpbnMoJ29wZW4nKSkge1xuICAgICAgICAgIGN1c3RvbUV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KCdjYW52YXMub3BlbmVkJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY3VzdG9tRXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoJ2NhbnZhcy5jbG9zZWQnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIERpc3BhdGNoIHRoZSAnY2FudmFzLm9wZW5lZCcvICdjYW52YXMuY2xvc2VkJyBldmVudHNcbiAgICAgICAgY2FudmFzLmRpc3BhdGNoRXZlbnQoY3VzdG9tRXZlbnQpO1xuICAgICAgfSwgMzAwKTtcbiAgICB9IC8vIGlmIChjYW52YXMgIT09IG51bGwpXG4gIH07IC8vIGZuVG9nZ2xlXG5cbiAgY29uc3QgZm5UcmlnZ2VyQ2xpY2sgPSAoZXZ0KSA9PiB7XG4gICAgaWYgKGV2dCkge1xuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuXG4gICAgZm5Ub2dnbGUoXG4gICAgICBldnQuY3VycmVudFRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnKSB8fCAnb2ZmY2FudmFzJyxcbiAgICAgIGV2dC5jdXJyZW50VGFyZ2V0XG4gICAgKTtcbiAgfTsgLy8gZm5UcmlnZ2VyQ2xpY2tcblxuICAvLyBGaW5kIGFsbCBleGlzdGluZyB0cmlnZ2Vyc1xuICBjb25zdCB0cmlnZ2VycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tyb2xlPVwib2ZmY2FudmFzXCJdJyk7XG5cbiAgLy8gRmluZCBhbGwgZXhpc3Rpbmcgb2ZmY2FudmFzXG4gIGNvbnN0IGNhbnZhc2VzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm9mZmNhbnZhcycpO1xuXG4gIGlmICh0cmlnZ2VycyAhPT0gbnVsbCkge1xuICAgIHRyaWdnZXJzLmZvckVhY2goZnVuY3Rpb24odHJpZ2dlciwgaSkge1xuICAgICAgdHJpZ2dlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZuVHJpZ2dlckNsaWNrKTtcbiAgICB9KTsgLy8gdHJpZ2dlcnMuZm9yRWFjaChmdW5jdGlvbih0cmlnZ2VyLCBpKVxuICB9IC8vIGlmICh0cmlnZ2VycyAhPT0gbnVsbClcblxuICBpZiAoY2FudmFzZXMgIT09IG51bGwpIHtcbiAgICBjYW52YXNlcy5mb3JFYWNoKChjYW52YXMsIGkpID0+IHtcbiAgICAgIC8vIEF0dGFjaCBtZXRob2QgZm9yIG9wZW5pbmdcbiAgICAgIGNhbnZhcy5vcGVuID0gKCkgPT4ge1xuICAgICAgICBmblRvZ2dsZShjYW52YXMuZ2V0QXR0cmlidXRlKCdpZCcpIHx8ICdvZmZjYW52YXMnKTtcbiAgICAgIH07IC8vIG9wZW5cblxuICAgICAgLy8gQXR0YWNoIG1ldGhvZCBmb3IgY2xvc2luZ1xuICAgICAgY2FudmFzLmNsb3NlID0gKCkgPT4ge307IC8vIGNsb3NlXG4gICAgfSk7IC8vIGNhbnZhc2VzLmZvckVhY2goKGNhbnZhcywgaSlcbiAgfSAvLyBpZiAoY2FudmFzZXMgIT09IG51bGwpXG5cbiAgcmV0dXJuIHtcbiAgICBnZXQ6IChpZHgpID0+IHtcbiAgICAgIGlmICh0eXBlb2YgaWR4ID09PSAnc3RyaW5nJykge1xuICAgICAgICBsZXQgY2FudmFzID0gZmFsc2U7XG5cbiAgICAgICAgY2FudmFzZXMuZm9yRWFjaCgobm9kZSkgPT4ge1xuICAgICAgICAgIGlmIChub2RlLmlkID09PSBpZHgucmVwbGFjZSgvXiMvLCAnJykpIHtcbiAgICAgICAgICAgIGNhbnZhcyA9IG5vZGU7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gY2FudmFzO1xuICAgICAgfVxuXG4gICAgICBpZiAodHlwZW9mIGNhbnZhc1tpZHhdICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICByZXR1cm4gY2FudmFzW2lkeF07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH07XG59OyAvLyBzZWVkT2ZmQ2FudmFzXG5cbmlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykge1xuICBpZiAodHlwZW9mIG1vZHVsZS5leHBvcnRzLlNlZWRDU1MgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMuU2VlZENTUyA9IHt9O1xuICB9XG5cbiAgbW9kdWxlLmV4cG9ydHMuU2VlZENTUy5vZmZDYW52YXMgPSBzZWVkT2ZmQ2FudmFzO1xufSBlbHNlIHtcbiAgaWYgKHR5cGVvZiB3aW5kb3cuU2VlZENTUyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICB3aW5kb3cuU2VlZENTUyA9IHt9O1xuICB9XG5cbiAgd2luZG93LlNlZWRDU1Mub2ZmQ2FudmFzID0gc2VlZE9mZkNhbnZhcztcbn1cbiIsIi8qKiFcbiAqIFNlZWQtQ1NTIC0gU2Nyb2xsLlxuICogQGF1dGhvciBSb2dlcmlvIFRhcXVlcyAoaGVsbG9AYWJ0ei5jbylcbiAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL0FidHpMYWJzL3NlZWQtY3NzXG4gKiBAdmVyc2lvbiAyLjAuMVxuICogQGxpY2Vuc2UgTUlUXG4gKi9cblxuY29uc3Qgc2VlZFNjcm9sbCA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGxldCB0cmlnZ2VycyA9IG51bGw7XG5cbiAgbGV0IHNjcm9sbFRhcmdldCA9IDA7XG5cbiAgY29uc3QgZ3V0dGVyID0gNTA7XG5cbiAgY29uc3QgZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgc3B5U2Nyb2xsQ29udGFpbmVyOiAnbmF2JyxcbiAgICBzcHlTY3JvbGw6ICdhLnNtb290aCcsXG4gICAgcmV2ZWFsV2hlblZpc2libGU6ICcucmV2ZWFsJ1xuICB9OyAvLyBkZWZhdWx0T3B0aW9uc1xuXG4gIGNvbnN0IGZuVXBkYXRlQWN0aXZlVHJpZ2dlciA9IChlbGVtKSA9PiB7XG4gICAgdHJpZ2dlcnMuZm9yRWFjaCgoZWwpID0+IHtcbiAgICAgIGVsLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuICAgIH0pO1xuXG4gICAgaWYgKGVsZW0pIHtcbiAgICAgIGVsZW0uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XG4gICAgfVxuICB9OyAvLyBmblVwZGF0ZUFjdGl2ZVRyaWdnZXJcblxuICBjb25zdCBmbkdldE9mZnNldCA9IChlbGVtKSA9PiB7XG4gICAgY29uc3QgYm9keU9mZnNldCA9IGRvY3VtZW50LmJvZHkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgY29uc3Qgb2Zmc2V0ID0gZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgIHJldHVybiB7XG4gICAgICB0b3A6IE1hdGguY2VpbChvZmZzZXQudG9wIC0gYm9keU9mZnNldC50b3ApLFxuICAgICAgbGVmdDogTWF0aC5jZWlsKG9mZnNldC5sZWZ0IC0gYm9keU9mZnNldC5sZWZ0KVxuICAgIH07XG4gIH07IC8vIGZuR2V0T2Zmc2V0XG5cbiAgY29uc3QgZm5TY3JvbGxDb21wbGV0ZSA9IChldnQpID0+IHtcbiAgICBpZiAod2luZG93LnNjcm9sbFkgPT09IHNjcm9sbFRhcmdldCkge1xuICAgICAgY29uc3Qgc2VlZEN1c3RvbUV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KCdzY3JvbGwuY29tcGxldGUnKTtcbiAgICAgIGRvY3VtZW50LmRpc3BhdGNoRXZlbnQoc2VlZEN1c3RvbUV2ZW50KTtcbiAgICB9XG5cbiAgICBpZiAodHJpZ2dlcnMpIHtcbiAgICAgIGNvbnN0IGZpcnN0RWxlbWVudE9mZnNldCA9IGZuR2V0T2Zmc2V0KHRyaWdnZXJzWzBdKTtcblxuICAgICAgaWYgKHdpbmRvdy5zY3JvbGxZIDwgZmlyc3RFbGVtZW50T2Zmc2V0LnRvcCkge1xuICAgICAgICBmblVwZGF0ZUFjdGl2ZVRyaWdnZXIoKTtcbiAgICAgIH1cblxuICAgICAgdHJpZ2dlcnMuZm9yRWFjaCgoZWwsIGkpID0+IHtcbiAgICAgICAgY29uc3QgdGFyZ2V0SUQgPVxuICAgICAgICAgIGVsLmdldEF0dHJpYnV0ZSgnaHJlZicpIHx8IGVsLmdldEF0dHJpYnV0ZSgnZGF0YS10YXJnZXQnKTtcblxuICAgICAgICBjb25zdCB0YXJnZXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRhcmdldElEKTtcbiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gZm5HZXRPZmZzZXQodGFyZ2V0KTtcblxuICAgICAgICBpZiAob2Zmc2V0LnRvcCAtIGd1dHRlciA8PSB3aW5kb3cuc2Nyb2xsWSkge1xuICAgICAgICAgIGZuVXBkYXRlQWN0aXZlVHJpZ2dlcihlbCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvdy5vbGRPbnNjcm9sbCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgd2luZG93Lm9sZE9uc2Nyb2xsKGV2dCk7XG4gICAgfVxuICB9OyAvLyBmblNjcm9sbENvbXBsZXRlXG5cbiAgY29uc3QgZm5UcmlnZ2VyQ2xpY2sgPSAoZXZ0KSA9PiB7XG4gICAgaWYgKGV2dCkge1xuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuXG4gICAgY29uc3QgdGFyZ2V0ID1cbiAgICAgIGV2dC5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSgnaHJlZicpIHx8XG4gICAgICBldnQuY3VycmVudFRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtdGFyZ2V0Jyk7XG5cbiAgICBpZiAodGFyZ2V0KSB7XG4gICAgICBjb25zdCBlbGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0YXJnZXQpO1xuXG4gICAgICBzY3JvbGxUYXJnZXQgPSBmbkdldE9mZnNldChlbGVtKS50b3AgLSBndXR0ZXI7IC8vIGFkZCBzb21lIGd1dHRlclxuXG4gICAgICB3aW5kb3cuc2Nyb2xsVG8oe1xuICAgICAgICBiZWhhdmlvcjogJ3Ntb290aCcsXG4gICAgICAgIGxlZnQ6IDAsXG4gICAgICAgIHRvcDogc2Nyb2xsVGFyZ2V0XG4gICAgICB9KTtcbiAgICB9XG4gIH07IC8vIGZuVHJpZ2dlckNsaWNrXG5cbiAgd2luZG93Lm9sZE9uc2Nyb2xsID0gd2luZG93Lm9uc2Nyb2xsO1xuICB3aW5kb3cub25zY3JvbGwgPSBmblNjcm9sbENvbXBsZXRlO1xuXG4gIG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0T3B0aW9ucywgb3B0aW9ucyk7XG5cbiAgLy8gRmluZCBhbGwgZXhpc3RpbmcgdHJpZ2dlcnMgZm9yIHNtb290aCBzY3JvbGxpbmdcbiAgdHJpZ2dlcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKG9wdGlvbnMuc3B5U2Nyb2xsKTtcblxuICBpZiAodHJpZ2dlcnMgIT09IG51bGwpIHtcbiAgICB0cmlnZ2Vycy5mb3JFYWNoKGZ1bmN0aW9uKHRyaWdnZXIsIGkpIHtcbiAgICAgIHRyaWdnZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmblRyaWdnZXJDbGljayk7XG4gICAgfSk7IC8vIHRyaWdnZXJzLmZvckVhY2goZnVuY3Rpb24odHJpZ2dlciwgaSlcbiAgfSAvLyBpZiAodHJpZ2dlcnMgIT09IG51bGwpXG5cbiAgLy9cbn07IC8vIHNlZWRTY3JvbGxcblxuaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSB7XG4gIGlmICh0eXBlb2YgbW9kdWxlLmV4cG9ydHMuU2VlZENTUyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBtb2R1bGUuZXhwb3J0cy5TZWVkQ1NTID0ge307XG4gIH1cblxuICBtb2R1bGUuZXhwb3J0cy5TZWVkQ1NTLnNjcm9sbCA9IHNlZWRTY3JvbGw7XG59IGVsc2Uge1xuICBpZiAodHlwZW9mIHdpbmRvdy5TZWVkQ1NTID09PSAndW5kZWZpbmVkJykge1xuICAgIHdpbmRvdy5TZWVkQ1NTID0ge307XG4gIH1cblxuICB3aW5kb3cuU2VlZENTUy5zY3JvbGwgPSBzZWVkU2Nyb2xsO1xufVxuIiwiLyoqIVxuICogU2VlZC1DU1MgLSBBZGRpdGlvbmFsIGZlYXR1cmVzIGZvciBIVE1MIFRleHRhcmVhcy5cbiAqIEBhdXRob3IgUm9nZXJpbyBUYXF1ZXMgKGhlbGxvQGFidHouY28pXG4gKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9BYnR6TGFicy9zZWVkLWNzc1xuICogQHZlcnNpb24gMi4wLjFcbiAqIEBsaWNlbnNlIE1JVFxuICovXG5cbmNvbnN0IHNlZWRUZXh0YXJlYSA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgLy8gRmluZCBhbGwgc2VlZC1maWxlIGlucHV0cy5cbiAgY29uc3QgaW5wdXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZpZWxkID4gdGV4dGFyZWEnKTtcblxuICBpZiAoaW5wdXRzICE9PSBudWxsKSB7XG4gICAgaW5wdXRzLmZvckVhY2goZnVuY3Rpb24oaW5wdXQsIGkpIHtcbiAgICAgIGxldCBtYXhMZW5ndGggPSAwO1xuXG4gICAgICBjb25zdCBwYXJlbnQgPSBpbnB1dC5wYXJlbnROb2RlO1xuICAgICAgY29uc3QgY291bnRlckxhYmVsID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJ1tyb2xlPVwiY291bnRlclwiXScpO1xuICAgICAgY29uc3QgdGVtcGxhdGUgPVxuICAgICAgICBjb3VudGVyTGFiZWwuZ2V0QXR0cmlidXRlKCdkYXRhLXRlbXBsYXRlJykgfHxcbiAgICAgICAgJ1R5cGVkICVhIG91dCBvZiAlYi4gUmVtYWluaW5nICVjLic7XG5cbiAgICAgIGNvbnN0IGZuQ2FsYyA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgdHlwZWQgPSBpbnB1dC52YWx1ZS5yZXBsYWNlKC9bXFxuXFxyXS9nLCAnJykubGVuZ3RoO1xuICAgICAgICBjb25zdCByZW1haW5pbmcgPSBtYXhMZW5ndGggLSB0eXBlZDtcbiAgICAgICAgY29uc3QgbWluTGVuZ3RoID0gTWF0aC5mbG9vcihtYXhMZW5ndGggKiAwLjEpO1xuXG4gICAgICAgIGNvdW50ZXJMYWJlbC5pbm5lckhUTUwgPSB0ZW1wbGF0ZVxuICAgICAgICAgIC5yZXBsYWNlKCclYScsIHR5cGVkKVxuICAgICAgICAgIC5yZXBsYWNlKCclYicsIG1heExlbmd0aClcbiAgICAgICAgICAucmVwbGFjZShcbiAgICAgICAgICAgICclYycsXG4gICAgICAgICAgICByZW1haW5pbmcgPD0gbWluTGVuZ3RoXG4gICAgICAgICAgICAgID8gYDxzcGFuIGNsYXNzPVwicmVkXCIgPiR7cmVtYWluaW5nfTwvc3Bhbj5gXG4gICAgICAgICAgICAgIDogcmVtYWluaW5nXG4gICAgICAgICAgKTtcbiAgICAgIH07XG5cbiAgICAgIG1heExlbmd0aCA9IGlucHV0LmdldEF0dHJpYnV0ZSgnbWF4bGVuZ3RoJyk7XG5cbiAgICAgIC8vIElnbm9yZSBpZiBtYXhsZW5ndGggaXMgbm90IGdpdmVuXG4gICAgICBpZiAoIW1heExlbmd0aCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIE1ha2Ugc3VyZSB0aGUgbGltaXQgaXMgYW4gaW50ZWdlclxuICAgICAgbWF4TGVuZ3RoID0gcGFyc2VJbnQobWF4TGVuZ3RoKTtcblxuICAgICAgLy8gQXR0YWNoIHRoZSBoYW5kbGVyc1xuICAgICAgJ2tleXByZXNzIGtleWRvd24ga2V5dXAnLnNwbGl0KCcgJykuZm9yRWFjaCgoZXZ0KSA9PiB7XG4gICAgICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoZXZ0LCBmbkNhbGMsIHRydWUpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIEluaXRpYWxpemUgdGhlIHV0aWxpdHkgbGFiZWxcbiAgICAgIGZuQ2FsYygpO1xuICAgIH0pOyAvLyBpbnB1dHMuZm9yRWFjaChmdW5jdGlvbihpbnB1dCwgaSlcbiAgfSAvLyBpZiAoaW5wdXRzICE9PSBudWxsKVxufTsgLy8gc2VlZFRleHRhcmVhXG5cbmlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykge1xuICBpZiAodHlwZW9mIG1vZHVsZS5leHBvcnRzLlNlZWRDU1MgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMuU2VlZENTUyA9IHt9O1xuICB9XG5cbiAgbW9kdWxlLmV4cG9ydHMuU2VlZENTUy50ZXh0QXJlYSA9IHNlZWRUZXh0YXJlYTtcbn0gZWxzZSB7XG4gIGlmICh0eXBlb2Ygd2luZG93LlNlZWRDU1MgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgd2luZG93LlNlZWRDU1MgPSB7fTtcbiAgfVxuXG4gIHdpbmRvdy5TZWVkQ1NTLnRleHRBcmVhID0gc2VlZFRleHRhcmVhO1xufVxuIl19
