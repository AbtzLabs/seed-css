/*! 
 * Seed CSS (seed-css) 
 * A light-weight, mobile first and responsive CSS boilerplate. 
 * @author Rogerio Taques (hello@abtz.co) 
 * @copyright 2016-2019, Rogerio Taques (hello@abtz.co) 
 * @license MIT 
 * @version 2.2.0 
 */ 

 "use strict";!function(){function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n}return"function"!=typeof window.CustomEvent&&(t.prototype=window.Event.prototype,void(window.CustomEvent=t))}();
"use strict";var seedFileUpload=function(){var e=function(e){e&&e.preventDefault();var t,i=!1,n=this,l=n.nextElementSibling;n.files&&n.files.length>1?i=(n.getAttribute("data-multiple")||"{count} files").replace("{count}",n.files.length):n.value.trim().length>0&&(i=n.value.split("\\").pop()),i&&(l.querySelector(".input").innerHTML=i),""!==n.value&&(t=new CustomEvent("file.chosen"),n.parentNode.classList.add("chosen"),n.dispatchEvent(t))},t=document.querySelectorAll('.seed-file > [type="file"]');null!==t&&t.forEach(function(t,i){var n=t.nextElementSibling,l=n.querySelector(".cancel"),r=t.getAttribute("data-empty")||"No file chosen";n&&(t.getAttribute("id")&&t.getAttribute("id")!==n.getAttribute("for")?n.setAttribute("for",t.getAttribute("id")):n.getAttribute("for")&&!t.getAttribute("id")?t.setAttribute("id",n.getAttribute("for")):(t.setAttribute("id","file-input-"+i),n.setAttribute("for","file-input-"+i)),l&&l.addEventListener("click",function(e){e&&e.preventDefault();var i=t.getAttribute("data-empty")||"No file chosen";t.value="",t.parentNode.classList.remove("chosen"),n.querySelector(".input").innerHTML=i,seedCustomEvent=new CustomEvent("file.removed"),t.dispatchEvent(seedCustomEvent)}),n.querySelector(".input").innerHTML=r,t.addEventListener("change",e))})};"undefined"!=typeof module?module.exports.fileUpload=fileUpload:("undefined"==typeof window.SeedCSS&&(window.SeedCSS={}),window.SeedCSS.fileUpload=seedFileUpload);
"use strict";var fnOpen,fnClose,fnEsc,seedModal=function(e){var n={trigger:'[role="modal"]',classAnimation:{open:"bounceInDown",close:"bounceOutUp"}};e=Object.assign({},n,e);var o=document.querySelectorAll(".modal"),t=document.querySelectorAll(e.trigger);return fnClose=function(n){if(n){var o,t=document.querySelector("html"),s=n.querySelector(".modal-window");s&&(document.removeEventListener("keydown",fnEsc),s.classList.replace(e.classAnimation.open,e.classAnimation.close),n.classList.add("delay-1s"),n.classList.replace("fadeIn","fadeOut"),setTimeout(function(){o=new CustomEvent("modal.closed"),n.dispatchEvent(o),n.classList.add("hide"),t.style.overflow="",n.classList.remove("delay-1s","fadeOut"),s.classList.replace(e.classAnimation.close,e.classAnimation.open)},600))}},fnOpen=function(n){if(n){var o,t=document.querySelector("html"),s=n.querySelector(".modal-window");fnEsc=function(e){var o=e.keyCode||e.which;27===o&&fnClose(n)},s&&(document.addEventListener("keydown",fnEsc),n.style.display="",n.classList.add("animated","fadeIn","fast"),s.classList.add("animated",e.classAnimation.open),n.classList.remove("hide"),t.style.overflow="hidden",setTimeout(function(){o=new CustomEvent("modal.opened"),n.dispatchEvent(o)},100))}},null!==o&&o.forEach(function(e,n){var o=e.querySelectorAll('[role="modal-dismiss"]');e.addEventListener("click",function(){fnClose(e)}),e.show=function(){fnOpen(e)},e.hide=function(){fnClose(e)},null!==o&&o.forEach(function(n,o){n.addEventListener("click",function(n){n&&(n.preventDefault(),n.stopPropagation()),fnClose(e)})})}),null!==t&&t.forEach(function(e,n){e.addEventListener("click",function(n){n&&n.preventDefault();var o=e.getAttribute("data-modal-id");if(null!==o){var t=document.querySelector("#".concat(o));fnOpen(t)}})}),t=void 0,{get:function(e){if("string"==typeof e){var n=!1;return o.forEach(function(o){if(o.id===e.replace(/^#/,""))return void(n=o)}),n}return"undefined"!=typeof o[e]&&o[e]}}};"undefined"!=typeof module?module.exports.seedModal=seedModal:("undefined"==typeof window.SeedCSS&&(window.SeedCSS={}),window.SeedCSS.modal=seedModal);
"use strict";var seedOffCanvas=function(){var e=function(e,n){var t,o=document.querySelector("#".concat(e.replace(/^#/,""))),a=n||document.querySelector('[role="offcanvas"][data-id="'.concat(e.replace(/^#/,""),'"]'));null!==o&&(o.classList.toggle("open"),o.classList.contains("open")?(null!==a&&a.classList.add("triggered"),document.querySelector("html").style.overflow="hidden"):(document.querySelectorAll('[role="offcanvas"][data-id="'.concat(e.replace(/^#/,""),'"]')).forEach(function(e){e.classList.remove("triggered")}),document.querySelector("html").style.overflow=""),setTimeout(function(){t=o.classList.contains("open")?new CustomEvent("canvas.opened"):new CustomEvent("canvas.closed"),o.dispatchEvent(t)},300))},n=function(n){n&&n.preventDefault(),e(n.currentTarget.getAttribute("data-id")||"offcanvas",n.currentTarget)},t=document.querySelectorAll('[role="offcanvas"]'),o=document.querySelectorAll(".offcanvas");return null!==t&&t.forEach(function(e,t){e.addEventListener("click",n)}),null!==o&&o.forEach(function(n,t){n.open=function(){e(n.getAttribute("id")||"offcanvas")},n.close=function(){}}),{get:function(e){if("string"==typeof e){var n=!1;return o.forEach(function(t){if(t.id===e.replace(/^#/,""))return void(n=t)}),n}return"undefined"!=typeof canvas[e]&&canvas[e]}}};"undefined"!=typeof module?module.exports.seedOffCanvas=seedOffCanvas:("undefined"==typeof window.SeedCSS&&(window.SeedCSS={}),window.SeedCSS.offCanvas=seedOffCanvas);
"use strict";var seedScroll=function(e){var t=null,n=null,o=0,i={spyScrollSelector:"nav a.smooth",revealElementSelector:".reveal",revealSpaceOffset:.2,revealWhenVisible:"visible",revealSingleAnimation:"visible-once",revealWhenHidden:"hidden",gutter:50},l=function(e){t.forEach(function(e){e.classList.remove("active")}),e&&e.classList.add("active")},r=function(e){var t=document.body.getBoundingClientRect(),n=e.getBoundingClientRect();return{top:Math.ceil(n.top-t.top),left:Math.ceil(n.left-t.left)}},c=function(n){if(window.scrollY===o){var i=new CustomEvent("scroll.complete");document.dispatchEvent(i)}if(t){var c=r(t[0]);window.scrollY<c.top&&l(),t.forEach(function(t,n){try{var o=t.getAttribute("href")||t.getAttribute("data-target"),i=document.querySelector(o),c=r(i);if(c.top-e.gutter<=window.scrollY)return void l(t)}catch(d){}})}"function"==typeof window.oldOnscroll&&window.oldOnscroll(n)},d=function(t){t&&t.preventDefault();var n=t.currentTarget.getAttribute("href")||t.currentTarget.getAttribute("data-target");if(n){var i=document.querySelector(n);o=r(i).top-e.gutter,window.scrollTo({behavior:"smooth",left:0,top:o})}},a=function(){var t=function(){return{width:window.document.documentElement.clientWidth,height:window.document.documentElement.clientHeight}},o=function(){return{x:window.pageXOffset,y:window.pageYOffset}},i=function(e){var t=e,n=0,o=0,i=t.offsetWidth,l=t.offsetHeight;do isNaN(t.offsetTop)||(n+=t.offsetTop),isNaN(t.offsetLeft)||(o+=t.offsetLeft);while(null!==(t=t.offsetParent));return{top:n,left:o,height:l,width:i}},l=function(n){var l=t(),r=o(),c=i(n),d=e.revealSpaceOffset,a=function(){var e=c.top+c.height*d,t=c.left+c.width*d,n=c.left+c.width-c.width*d,o=c.top+c.height-c.height*d,i=r.y+0,a=r.x+0,s=r.y-0+l.height,f=r.x-0+l.width;return e<s&&o>i&&t>a&&n<f};return a()},r=function(){if(n)for(var t=0;t<n.length;t+=1)l(n[t])?(e.revealWhenVisible&&n[t].classList.add(e.revealWhenVisible),e.revealWhenHidden&&n[t].classList.remove(e.revealWhenHidden)):n[t].classList.contains(e.revealSingleAnimation)===!1&&(e.revealWhenHidden&&n[t].classList.add(e.revealWhenHidden),e.revealWhenVisible&&n[t].classList.remove(e.revealWhenVisible))},c=function(e){r()};window.addEventListener("scroll",c,!1),window.addEventListener("resize",c,!1)};return window.oldOnscroll=window.onscroll,window.onscroll=c,e=Object.assign({},i,e),t=document.querySelectorAll(e.spyScrollSelector),n=document.querySelectorAll(e.revealElementSelector),null!==t&&t.forEach(function(e,t){e.addEventListener("click",d)}),n&&a(),{}};"undefined"!=typeof module?module.exports.seedScroll=seedScroll:("undefined"==typeof window.SeedCSS&&(window.SeedCSS={}),window.SeedCSS.scroll=seedScroll);
"use strict";var seedTextarea=function(){var e=document.querySelectorAll(".field > textarea");null!==e&&e.forEach(function(e,t){var a=0,r=e.parentNode,n=r.querySelector('[role="counter"]'),o=n.getAttribute("data-template")||"Typed %a out of %b. Remaining %c.",d=function(){var t=e.value.replace(/[\n\r]/g,"").length,r=a-t,d=Math.floor(.1*a);n.innerHTML=o.replace("%a",t).replace("%b",a).replace("%c",r<=d?'<span class="red" >'.concat(r,"</span>"):r)};a=e.getAttribute("maxlength"),a&&(a=parseInt(a),"keypress keydown keyup".split(" ").forEach(function(t){e.addEventListener(t,d,!0)}),d())})};"undefined"!=typeof module?module.exports.seedTextarea=seedTextarea:("undefined"==typeof window.SeedCSS&&(window.SeedCSS={}),window.SeedCSS.textArea=seedTextarea);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImN1c3RvbUV2ZW50UG9seWZpbGwuanMiLCJzZWVkRmlsZVVwbG9hZC5qcyIsInNlZWRNb2RhbC5qcyIsInNlZWRPZmZDYW52YXMuanMiLCJzZWVkU2Nyb2xsLmpzIiwic2VlZFRleHRhcmVhLmpzIl0sIm5hbWVzIjpbIkN1c3RvbUV2ZW50IiwiZXZlbnQiLCJwYXJhbXMiLCJidWJibGVzIiwiY2FuY2VsYWJsZSIsImRldGFpbCIsInVuZGVmaW5lZCIsImV2dCIsImRvY3VtZW50IiwiY3JlYXRlRXZlbnQiLCJpbml0Q3VzdG9tRXZlbnQiLCJ3aW5kb3ciLCJwcm90b3R5cGUiLCJFdmVudCIsInNlZWRGaWxlVXBsb2FkIiwiZm5DaGFuZ2UiLCJwcmV2ZW50RGVmYXVsdCIsInNlZWRDdXN0b21FdmVudCIsImZpbGVOYW1lIiwiaW5wdXQiLCJ0aGlzIiwibGFiZWwiLCJuZXh0RWxlbWVudFNpYmxpbmciLCJmaWxlcyIsImxlbmd0aCIsImdldEF0dHJpYnV0ZSIsInJlcGxhY2UiLCJ2YWx1ZSIsInRyaW0iLCJzcGxpdCIsInBvcCIsInF1ZXJ5U2VsZWN0b3IiLCJpbm5lckhUTUwiLCJwYXJlbnROb2RlIiwiY2xhc3NMaXN0IiwiYWRkIiwiZGlzcGF0Y2hFdmVudCIsImlucHV0cyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiaSIsImNhbmNlbCIsImVtcHR5VGV4dCIsInNldEF0dHJpYnV0ZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZW1vdmUiLCJtb2R1bGUiLCJleHBvcnRzIiwiZmlsZVVwbG9hZCIsIlNlZWRDU1MiLCJmbk9wZW4iLCJmbkNsb3NlIiwiZm5Fc2MiLCJzZWVkTW9kYWwiLCJvcHRpb25zIiwiZGVmYXVsdE9wdGlvbnMiLCJ0cmlnZ2VyIiwiY2xhc3NBbmltYXRpb24iLCJvcGVuIiwiY2xvc2UiLCJPYmplY3QiLCJhc3NpZ24iLCJtb2RhbHMiLCJtb2RhbFRyaWdnZXJzIiwibW9kYWxPYmplY3QiLCJjdXN0b21FdmVudCIsImh0bWwiLCJtV2luIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInNldFRpbWVvdXQiLCJzdHlsZSIsIm92ZXJmbG93IiwiZSIsImtleSIsImtleUNvZGUiLCJ3aGljaCIsImRpc3BsYXkiLCJtb2RhbCIsImRpc21pc3NhbHMiLCJzaG93IiwiaGlkZSIsImRpc21pc3MiLCJqIiwic3RvcFByb3BhZ2F0aW9uIiwicmVmIiwiY29uY2F0IiwiZ2V0IiwiaWR4Iiwibm9kZSIsImlkIiwic2VlZE9mZkNhbnZhcyIsImZuVG9nZ2xlIiwiY2FudmFzSUQiLCJ0cmlnZ2VyRWxlbWVudCIsImNhbnZhcyIsInRvZ2dsZSIsImNvbnRhaW5zIiwidGdyIiwiZm5UcmlnZ2VyQ2xpY2siLCJjdXJyZW50VGFyZ2V0IiwidHJpZ2dlcnMiLCJjYW52YXNlcyIsIm9mZkNhbnZhcyIsInNlZWRTY3JvbGwiLCJyZXZlYWxlcnMiLCJzY3JvbGxUYXJnZXQiLCJzcHlTY3JvbGxTZWxlY3RvciIsInJldmVhbEVsZW1lbnRTZWxlY3RvciIsInJldmVhbFNwYWNlT2Zmc2V0IiwicmV2ZWFsV2hlblZpc2libGUiLCJyZXZlYWxTaW5nbGVBbmltYXRpb24iLCJyZXZlYWxXaGVuSGlkZGVuIiwiZ3V0dGVyIiwiZm5VcGRhdGVBY3RpdmVUcmlnZ2VyIiwiZWxlbSIsImVsIiwiZm5HZXRPZmZzZXQiLCJib2R5T2Zmc2V0IiwiYm9keSIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsIm9mZnNldCIsInRvcCIsIk1hdGgiLCJjZWlsIiwibGVmdCIsImZuU2Nyb2xsQ29tcGxldGUiLCJzY3JvbGxZIiwiZmlyc3RFbGVtZW50T2Zmc2V0IiwidGFyZ2V0SUQiLCJ0YXJnZXQiLCJvbGRPbnNjcm9sbCIsInNjcm9sbFRvIiwiYmVoYXZpb3IiLCJmbldhdGNoRWxlbWVudHMiLCJnZXRWaWV3cG9ydFNpemUiLCJ3aWR0aCIsImRvY3VtZW50RWxlbWVudCIsImNsaWVudFdpZHRoIiwiaGVpZ2h0IiwiY2xpZW50SGVpZ2h0IiwiZ2V0Q3VycmVudFNjcm9sbCIsIngiLCJwYWdlWE9mZnNldCIsInkiLCJwYWdlWU9mZnNldCIsImdldEVsZW1JbmZvIiwib2Zmc2V0VG9wIiwib2Zmc2V0TGVmdCIsIm9mZnNldFdpZHRoIiwib2Zmc2V0SGVpZ2h0IiwiaXNOYU4iLCJvZmZzZXRQYXJlbnQiLCJpc0VsZW1lbnRWaXNpYmxlIiwidmlld3BvcnRTaXplIiwiY3VycmVudFNjcm9sbCIsImVJbmYiLCJzcGFjZU9mZnNldCIsImNoZWNrQm91bmRhcmllcyIsImVUb3AiLCJlTGVmdCIsImVSaWdodCIsImVCb3R0b20iLCJ3VG9wIiwid0xlZnQiLCJ3Qm90dG9tIiwid1JpZ2h0IiwidG9nZ2xlRWxlbWVudCIsInNjcm9sbFJlc2l6ZUhhbmRsZXIiLCJvbnNjcm9sbCIsInNjcm9sbCIsInNlZWRUZXh0YXJlYSIsIm1heExlbmd0aCIsInBhcmVudCIsImNvdW50ZXJMYWJlbCIsInRlbXBsYXRlIiwiZm5DYWxjIiwidHlwZWQiLCJyZW1haW5pbmciLCJtaW5MZW5ndGgiLCJmbG9vciIsInBhcnNlSW50IiwidGV4dEFyZWEiXSwibWFwcGluZ3MiOiJBQUFBLGNBS0EsV0FHRSxRQUFTQSxHQUFZQyxFQUFPQyxHQUMxQkEsRUFBU0EsSUFBWUMsU0FBUyxFQUFPQyxZQUFZLEVBQU9DLE9BQVFDLE9BQ2hFLElBQUlDLEdBQU1DLFNBQVNDLFlBQVksY0FPL0IsT0FOQUYsR0FBSUcsZ0JBQ0ZULEVBQ0FDLEVBQU9DLFFBQ1BELEVBQU9FLFdBQ1BGLEVBQU9HLFFBRUZFLEVBWFQsTUFBa0Msa0JBQXZCSSxRQUFPWCxjQWNsQkEsRUFBWVksVUFBWUQsT0FBT0UsTUFBTUQsZUFFckNELE9BQU9YLFlBQWNBO0FDdEJ2QixZQVFBLElBQU1jLGdCQUFpQixXQUdyQixHQUFNQyxHQUFXLFNBQWtCUixHQUM3QkEsR0FDRkEsRUFBSVMsZ0JBR04sSUFBSUMsR0FDQUMsR0FBVyxFQUVUQyxFQUFRQyxLQUNSQyxFQUFRRixFQUFNRyxrQkFHaEJILEdBQU1JLE9BQVNKLEVBQU1JLE1BQU1DLE9BQVMsRUFDdENOLEdBQ0VD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LGNBQWMsb0JBQ3BDK0ksRUFDSkQsRUFBYXBKLGFBQWEsa0JBQzFCLG9DQUVJc0osRUFBUyxXQUNiLEdBQU1DLEdBQVE3SixFQUFNUSxNQUFNRCxRQUFRLFVBQVcsSUFBSUYsT0FDM0N5SixFQUFZTixFQUFZSyxFQUN4QkUsRUFBWXhELEtBQUt5RCxNQUFrQixHQUFaUixFQUU3QkUsR0FBYTdJLFVBQVk4SSxFQUN0QnBKLFFBQVEsS0FBTXNKLEdBQ2R0SixRQUFRLEtBQU1pSixHQUNkakosUUFDQyxLQUNBdUosR0FBYUMsRUFBYixzQkFBQTdGLE9BQzBCNEYsRUFEMUIsV0FFSUEsR0FJVk4sR0FBWXhKLEVBQU1NLGFBQWEsYUFHMUJrSixJQUtMQSxFQUFZUyxTQUFTVCxHQUdyQix5QkFBeUI5SSxNQUFNLEtBQUtVLFFBQVEsU0FBQ2hDLEdBQzNDWSxFQUFNeUIsaUJBQWlCckMsRUFBS3dLLEdBQVEsS0FJdENBLE9BS2dCLG9CQUFYakksUUFDVEEsT0FBT0MsUUFBUTJILGFBQWVBLGNBRUEsbUJBQW5CL0osUUFBT3NDLFVBQ2hCdEMsT0FBT3NDLFlBR1R0QyxPQUFPc0MsUUFBUW9JLFNBQVdYIiwiZmlsZSI6InNlZWRjc3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiohXG4gKiBBIHNpbXBsZSBwb2x5ZmlsbCBmb3IgQ3VzdG9tRXZlbnRcbiAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0N1c3RvbUV2ZW50L0N1c3RvbUV2ZW50I1BvbHlmaWxsXG4gKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgaWYgKHR5cGVvZiB3aW5kb3cuQ3VzdG9tRXZlbnQgPT09ICdmdW5jdGlvbicpIHJldHVybiBmYWxzZTtcblxuICBmdW5jdGlvbiBDdXN0b21FdmVudChldmVudCwgcGFyYW1zKSB7XG4gICAgcGFyYW1zID0gcGFyYW1zIHx8IHsgYnViYmxlczogZmFsc2UsIGNhbmNlbGFibGU6IGZhbHNlLCBkZXRhaWw6IHVuZGVmaW5lZCB9O1xuICAgIHZhciBldnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnQ3VzdG9tRXZlbnQnKTtcbiAgICBldnQuaW5pdEN1c3RvbUV2ZW50KFxuICAgICAgZXZlbnQsXG4gICAgICBwYXJhbXMuYnViYmxlcyxcbiAgICAgIHBhcmFtcy5jYW5jZWxhYmxlLFxuICAgICAgcGFyYW1zLmRldGFpbFxuICAgICk7XG4gICAgcmV0dXJuIGV2dDtcbiAgfVxuXG4gIEN1c3RvbUV2ZW50LnByb3RvdHlwZSA9IHdpbmRvdy5FdmVudC5wcm90b3R5cGU7XG5cbiAgd2luZG93LkN1c3RvbUV2ZW50ID0gQ3VzdG9tRXZlbnQ7XG59KSgpO1xuIiwiLyoqIVxuICogU2VlZC1DU1MgLSBDdXN0b20gSFRNTCBJbnB1dCBGaWxlLlxuICogQGF1dGhvciBSb2dlcmlvIFRhcXVlcyAoaGVsbG9AYWJ0ei5jbylcbiAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL0FidHpMYWJzL3NlZWQtY3NzXG4gKiBAdmVyc2lvbiAyLjIuMFxuICogQGxpY2Vuc2UgTUlUXG4gKi9cblxuY29uc3Qgc2VlZEZpbGVVcGxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBjb25zdCBmbkNoYW5nZSA9IGZ1bmN0aW9uIGZuQ2hhbmdlKGV2dCkge1xuICAgIGlmIChldnQpIHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cblxuICAgIGxldCBzZWVkQ3VzdG9tRXZlbnQ7XG4gICAgbGV0IGZpbGVOYW1lID0gZmFsc2U7XG5cbiAgICBjb25zdCBpbnB1dCA9IHRoaXM7XG4gICAgY29uc3QgbGFiZWwgPSBpbnB1dC5uZXh0RWxlbWVudFNpYmxpbmc7XG5cbiAgICAvLyBXaGVuIG11bHRpcGxlIGZpbGVzIGFyZSBzZWxlY3RlZFxuICAgIGlmIChpbnB1dC5maWxlcyAmJiBpbnB1dC5maWxlcy5sZW5ndGggPiAxKSB7XG4gICAgICBmaWxlTmFtZSA9IChcbiAgICAgICAgaW5wdXQuZ2V0QXR0cmlidXRlKCdkYXRhLW11bHRpcGxlJykgfHwgJ3tjb3VudH0gZmlsZXMnXG4gICAgICApLnJlcGxhY2UoJ3tjb3VudH0nLCBpbnB1dC5maWxlcy5sZW5ndGgpO1xuICAgIH1cblxuICAgIC8vIFdoZW4gb25seSBvbmUgZmlsZSBpcyBzZWxlY3RlZFxuICAgIGVsc2UgaWYgKGlucHV0LnZhbHVlLnRyaW0oKS5sZW5ndGggPiAwKSB7XG4gICAgICBmaWxlTmFtZSA9IGlucHV0LnZhbHVlLnNwbGl0KCdcXFxcJykucG9wKCk7XG4gICAgfVxuXG4gICAgaWYgKGZpbGVOYW1lKSB7XG4gICAgICBsYWJlbC5xdWVyeVNlbGVjdG9yKCcuaW5wdXQnKS5pbm5lckhUTUwgPSBmaWxlTmFtZTtcbiAgICB9XG5cbiAgICBpZiAoaW5wdXQudmFsdWUgIT09ICcnKSB7XG4gICAgICBzZWVkQ3VzdG9tRXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoJ2ZpbGUuY2hvc2VuJyk7XG4gICAgICBpbnB1dC5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoJ2Nob3NlbicpO1xuICAgICAgaW5wdXQuZGlzcGF0Y2hFdmVudChzZWVkQ3VzdG9tRXZlbnQpO1xuICAgIH1cbiAgfTsgLy8gZm5DaGFuZ2VcblxuICAvLyBGaW5kIGFsbCBzZWVkLWZpbGUgaW5wdXRzLlxuICBjb25zdCBpbnB1dHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2VlZC1maWxlID4gW3R5cGU9XCJmaWxlXCJdJyk7XG5cbiAgaWYgKGlucHV0cyAhPT0gbnVsbCkge1xuICAgIGlucHV0cy5mb3JFYWNoKGZ1bmN0aW9uIChpbnB1dCwgaSkge1xuICAgICAgLy8gRmluZCB0aGUgZmllbGQgbGFiZWxcbiAgICAgIGNvbnN0IGxhYmVsID0gaW5wdXQubmV4dEVsZW1lbnRTaWJsaW5nO1xuICAgICAgY29uc3QgY2FuY2VsID0gbGFiZWwucXVlcnlTZWxlY3RvcignLmNhbmNlbCcpO1xuICAgICAgY29uc3QgZW1wdHlUZXh0ID0gaW5wdXQuZ2V0QXR0cmlidXRlKCdkYXRhLWVtcHR5JykgfHwgJ05vIGZpbGUgY2hvc2VuJztcblxuICAgICAgLy8gSWYgbGFiZWwgZG9lcyBub3QgZXhpc3RzLCBzaW1wbHkgZG8gbm90IHNldCBpdCB1cFxuICAgICAgaWYgKCFsYWJlbCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIE1ha2Ugc3VyZSBpbnB1dCBhbmQgbGFiZWwgbWF0Y2hlcyBhbmQgd29ya3MuXG4gICAgICBpZiAoXG4gICAgICAgIGlucHV0LmdldEF0dHJpYnV0ZSgnaWQnKSAmJlxuICAgICAgICBpbnB1dC5nZXRBdHRyaWJ1dGUoJ2lkJykgIT09IGxhYmVsLmdldEF0dHJpYnV0ZSgnZm9yJylcbiAgICAgICkge1xuICAgICAgICBsYWJlbC5zZXRBdHRyaWJ1dGUoJ2ZvcicsIGlucHV0LmdldEF0dHJpYnV0ZSgnaWQnKSk7XG4gICAgICB9IGVsc2UgaWYgKGxhYmVsLmdldEF0dHJpYnV0ZSgnZm9yJykgJiYgIWlucHV0LmdldEF0dHJpYnV0ZSgnaWQnKSkge1xuICAgICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoJ2lkJywgbGFiZWwuZ2V0QXR0cmlidXRlKCdmb3InKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoJ2lkJywgJ2ZpbGUtaW5wdXQtJyArIGkpO1xuICAgICAgICBsYWJlbC5zZXRBdHRyaWJ1dGUoJ2ZvcicsICdmaWxlLWlucHV0LScgKyBpKTtcbiAgICAgIH1cblxuICAgICAgLy8gQWx3YXlzIHRoZSBjYW5jZWwgYnV0dG9uIGV4aXN0cywgYWRkcyBhIGhhbmRsZXJcbiAgICAgIGlmIChjYW5jZWwpIHtcbiAgICAgICAgY2FuY2VsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2dCkgPT4ge1xuICAgICAgICAgIGlmIChldnQpIHtcbiAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IGVtcHR5VGV4dCA9XG4gICAgICAgICAgICBpbnB1dC5nZXRBdHRyaWJ1dGUoJ2RhdGEtZW1wdHknKSB8fCAnTm8gZmlsZSBjaG9zZW4nO1xuXG4gICAgICAgICAgaW5wdXQudmFsdWUgPSAnJztcbiAgICAgICAgICBpbnB1dC5wYXJlbnROb2RlLmNsYXNzTGlzdC5yZW1vdmUoJ2Nob3NlbicpO1xuICAgICAgICAgIGxhYmVsLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dCcpLmlubmVySFRNTCA9IGVtcHR5VGV4dDtcblxuICAgICAgICAgIHNlZWRDdXN0b21FdmVudCA9IG5ldyBDdXN0b21FdmVudCgnZmlsZS5yZW1vdmVkJyk7XG4gICAgICAgICAgaW5wdXQuZGlzcGF0Y2hFdmVudChzZWVkQ3VzdG9tRXZlbnQpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgbGFiZWwucXVlcnlTZWxlY3RvcignLmlucHV0JykuaW5uZXJIVE1MID0gZW1wdHlUZXh0O1xuXG4gICAgICAvLyBTdGFydCBsaXN0ZW5pbmcgdGhlIGZpZWxkIGZvciBjaGFuZ2VzXG4gICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmbkNoYW5nZSk7XG4gICAgfSk7IC8vIGlucHV0cy5mb3JFYWNoKGZ1bmN0aW9uKGlucHV0LCBpKVxuICB9IC8vIGlmIChpbnB1dHMgIT09IG51bGwpXG59OyAvLyBzZWVkRmlsZVVwbG9hZFxuXG5cbmlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykge1xuICBtb2R1bGUuZXhwb3J0cy5maWxlVXBsb2FkID0gZmlsZVVwbG9hZDtcbn0gZWxzZSB7XG4gIGlmICh0eXBlb2Ygd2luZG93LlNlZWRDU1MgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgd2luZG93LlNlZWRDU1MgPSB7fTtcbiAgfVxuXG4gIHdpbmRvdy5TZWVkQ1NTLmZpbGVVcGxvYWQgPSBzZWVkRmlsZVVwbG9hZDtcbn1cbiIsIi8qKiFcbiAqIFNlZWQtQ1NTIC0gTW9kYWxcbiAqIEBhdXRob3IgUm9nZXJpbyBUYXF1ZXMgKGhlbGxvQGFidHouY28pXG4gKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9BYnR6TGFicy9zZWVkLWNzc1xuICogQHZlcnNpb24gMi4yLjBcbiAqIEBsaWNlbnNlIE1JVFxuICovXG5cbmxldCBmbk9wZW47XG5cbmxldCBmbkNsb3NlO1xuXG5sZXQgZm5Fc2M7XG5cbmNvbnN0IHNlZWRNb2RhbCA9IChvcHRpb25zKSA9PiB7XG4gICd1c2Ugc3RyaWN0JztcblxuICAvLyBEZWZhdWx0IHNldHRpbmdzXG4gIGNvbnN0IGRlZmF1bHRPcHRpb25zID0ge1xuICAgIC8vIHRoZSBlbGVtZW50IHRoYXQgdHJpZ2dlcnMgdGhlIG1vZGFsXG4gICAgdHJpZ2dlcjogJ1tyb2xlPVwibW9kYWxcIl0nLFxuXG4gICAgLy8gQHNlZTogaHR0cHM6Ly9kYW5lZGVuLmdpdGh1Yi5pby9hbmltYXRlLmNzcy9cbiAgICAvLyBhbmltYXRlLmNzcyBjbGFzc2VzIHRvIGJlIHVzZWRcbiAgICBjbGFzc0FuaW1hdGlvbjoge1xuICAgICAgb3BlbjogJ2JvdW5jZUluRG93bicsXG4gICAgICBjbG9zZTogJ2JvdW5jZU91dFVwJ1xuICAgIH1cbiAgfTtcblxuICBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xuXG4gIC8vIEdldCBlbGVtZW50c1xuICBsZXQgbW9kYWxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1vZGFsJyk7XG4gIGxldCBtb2RhbFRyaWdnZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChvcHRpb25zLnRyaWdnZXIpO1xuXG4gIGZuQ2xvc2UgPSAobW9kYWxPYmplY3QpID0+IHtcbiAgICBpZiAoIW1vZGFsT2JqZWN0KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IGN1c3RvbUV2ZW50O1xuICAgIGNvbnN0IGh0bWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdodG1sJyk7XG4gICAgY29uc3QgbVdpbiA9IG1vZGFsT2JqZWN0LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbC13aW5kb3cnKTtcblxuICAgIGlmICghbVdpbikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFJlbW92ZXMgdGhlIEVTQyBsaXN0ZW5lclxuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBmbkVzYyk7XG5cbiAgICAvLyBSZXBsYWNlIG9wZW4gYW5pbWF0aW9uIHRvIGNsb3NlIHRoZSBtb2RhbCB3aW5kb3dcbiAgICBtV2luLmNsYXNzTGlzdC5yZXBsYWNlKFxuICAgICAgb3B0aW9ucy5jbGFzc0FuaW1hdGlvbi5vcGVuLFxuICAgICAgb3B0aW9ucy5jbGFzc0FuaW1hdGlvbi5jbG9zZVxuICAgICk7XG5cbiAgICAvLyBBZGQgYW5pbWF0aW9uIHRvIHRoZSBvdmVybGF5XG4gICAgbW9kYWxPYmplY3QuY2xhc3NMaXN0LmFkZCgnZGVsYXktMXMnKTtcbiAgICBtb2RhbE9iamVjdC5jbGFzc0xpc3QucmVwbGFjZSgnZmFkZUluJywgJ2ZhZGVPdXQnKTtcblxuICAgIC8vIFdhaXQgMiBzZWNvbmRzIGJlZm9yZSBjb21wbGV0ZSBkZSBwcm9jZXNzLlxuICAgIC8vIFRoaXMgaXMgdGhlIHRpbWUgdG8gZmluaXNoaW5nIGFsbCBhbmltYXRlLmNzcyBhbmltYXRpb25zXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAvLyBEaXNwYXRjaCB0aGUgJ21vZGFsLmNsb3NlZCcgZXZlbnRcbiAgICAgIGN1c3RvbUV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KCdtb2RhbC5jbG9zZWQnKTtcbiAgICAgIG1vZGFsT2JqZWN0LmRpc3BhdGNoRXZlbnQoY3VzdG9tRXZlbnQpO1xuXG4gICAgICAvLyBDb21wbGV0ZWx5IGhpZGUgdGhlIGNvbXBvbmVudFxuICAgICAgbW9kYWxPYmplY3QuY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xuICAgICAgLy8gUmVlbmFibGUgc2Nyb2xsaW5nIGZyb20gdGhlIEhUTUxcbiAgICAgIGh0bWwuc3R5bGUub3ZlcmZsb3cgPSAnJztcbiAgICAgIC8vIFJlbW92ZSBjbG9zaW5nIGNsYXNzZXMgZnJvbSBvdmVybGF5XG4gICAgICBtb2RhbE9iamVjdC5jbGFzc0xpc3QucmVtb3ZlKCdkZWxheS0xcycsICdmYWRlT3V0Jyk7XG4gICAgICAvLyBSZW1vdmUgY2xvc2luZyBjbGFzc2VzIGZyb20gbW9kYWwgd2luZG93XG4gICAgICBtV2luLmNsYXNzTGlzdC5yZXBsYWNlKFxuICAgICAgICBvcHRpb25zLmNsYXNzQW5pbWF0aW9uLmNsb3NlLFxuICAgICAgICBvcHRpb25zLmNsYXNzQW5pbWF0aW9uLm9wZW5cbiAgICAgICk7XG4gICAgfSwgNjAwKTtcbiAgfTsgLy8gZm5DbG9zZVxuXG4gIGZuT3BlbiA9IChtb2RhbE9iamVjdCkgPT4ge1xuICAgIGlmICghbW9kYWxPYmplY3QpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgY3VzdG9tRXZlbnQ7XG4gICAgY29uc3QgaHRtbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2h0bWwnKTtcbiAgICBjb25zdCBtV2luID0gbW9kYWxPYmplY3QucXVlcnlTZWxlY3RvcignLm1vZGFsLXdpbmRvdycpO1xuXG4gICAgLy8gSGFuZGxlIHRoZSBFU0MgZGlzbWlzc1xuICAgIGZuRXNjID0gZnVuY3Rpb24gZXNjSGFuZGxlcihlKSB7XG4gICAgICBjb25zdCBrZXkgPSBlLmtleUNvZGUgfHwgZS53aGljaDtcblxuICAgICAgLy8gV2hlbiB0aGUgRVNDIGtleSBpcyBwcmVzc2VkXG4gICAgICBpZiAoa2V5ID09PSAyNykge1xuICAgICAgICBmbkNsb3NlKG1vZGFsT2JqZWN0KTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgaWYgKCFtV2luKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gQWRkIChhbmQgcmVtb3ZlKSBhbiBFU0MgaGFuZGxlciBmb3IgdGhlIG92ZXJsYXlcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZm5Fc2MpO1xuXG4gICAgLy8gQ2xlYXIgaW5saW5lIGRpc3BsYXkgc3R5bGUsIGlmIGFueVxuICAgIG1vZGFsT2JqZWN0LnN0eWxlLmRpc3BsYXkgPSAnJztcbiAgICAvLyBBZGQgYW5pbWF0aW9uIHRvIHRoZSBvdmVybGF5XG4gICAgbW9kYWxPYmplY3QuY2xhc3NMaXN0LmFkZCgnYW5pbWF0ZWQnLCAnZmFkZUluJywgJ2Zhc3QnKTtcbiAgICAvLyBBZGQgYW5pbWF0aW9uIHRvIHRoZSBtb2RhbCB3aW5kb3dcbiAgICBtV2luLmNsYXNzTGlzdC5hZGQoJ2FuaW1hdGVkJywgb3B0aW9ucy5jbGFzc0FuaW1hdGlvbi5vcGVuKTtcbiAgICAvLyBTaG93IHRoZSBjb21wb25lbnRcbiAgICBtb2RhbE9iamVjdC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgLy8gRmluYWxseSBwcmV2ZW50IHNjcm9sbGluZ1xuICAgIGh0bWwuc3R5bGUub3ZlcmZsb3cgPSAnaGlkZGVuJztcblxuICAgIC8vIFdhaXQgdGhlIGFuaW1hdGlvbiBjb21wbGV0ZSB0byBkaXNwYXRjaCB0aGUgZXZlbnRcbiAgICAvLyBFYWNoIGFuaW1hdGUuY3NzIGFuaW1hdGlvbiB0YWtlcyAxc1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgLy8gRGlzcGF0Y2ggdGhlICdtb2RhbC5vcGVuZWQnIGV2ZW50XG4gICAgICBjdXN0b21FdmVudCA9IG5ldyBDdXN0b21FdmVudCgnbW9kYWwub3BlbmVkJyk7XG4gICAgICBtb2RhbE9iamVjdC5kaXNwYXRjaEV2ZW50KGN1c3RvbUV2ZW50KTtcbiAgICB9LCAxMDApO1xuICB9OyAvLyBmbk9wZW5cblxuICBpZiAobW9kYWxzICE9PSBudWxsKSB7XG4gICAgbW9kYWxzLmZvckVhY2goKG1vZGFsLCBpKSA9PiB7XG4gICAgICAvLyBIYW5kbGUgdGhlIGRpc21pc3MgYnV0dG9uc1xuICAgICAgY29uc3QgZGlzbWlzc2FscyA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tyb2xlPVwibW9kYWwtZGlzbWlzc1wiXScpO1xuXG4gICAgICAvLyBBZGQgKGFuZCByZW1vdmUpIGEgY2xpY2sgaGFuZGxlciBvbiB0aGUgb3ZlcmxheVxuICAgICAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgIGZuQ2xvc2UobW9kYWwpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIEFkZCBwcm90b3R5cGUgZm9yIHNob3cgKG9wZW4pXG4gICAgICBtb2RhbC5zaG93ID0gKCkgPT4ge1xuICAgICAgICBmbk9wZW4obW9kYWwpO1xuICAgICAgfTtcblxuICAgICAgLy8gQWRkIHByb3RvdHlwZSBmb3IgaGlkZSAoY2xvZGUpXG4gICAgICBtb2RhbC5oaWRlID0gKCkgPT4ge1xuICAgICAgICBmbkNsb3NlKG1vZGFsKTtcbiAgICAgIH07XG5cbiAgICAgIGlmIChkaXNtaXNzYWxzICE9PSBudWxsKSB7XG4gICAgICAgIGRpc21pc3NhbHMuZm9yRWFjaCgoZGlzbWlzcywgaikgPT4ge1xuICAgICAgICAgIGRpc21pc3MuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZ0KSA9PiB7XG4gICAgICAgICAgICBpZiAoZXZ0KSB7XG4gICAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICBldnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZuQ2xvc2UobW9kYWwpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0gLy8gaWYgKGRpc21pc3NhbHMgIT09IG51bGwpXG4gICAgfSk7XG4gIH0gLy8gaWYgKG1vZGFscyAhPT0gbnVsbClcblxuICBpZiAobW9kYWxUcmlnZ2VycyAhPT0gbnVsbCkge1xuICAgIG1vZGFsVHJpZ2dlcnMuZm9yRWFjaCgodHJpZ2dlciwgaSkgPT4ge1xuICAgICAgdHJpZ2dlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldnQpID0+IHtcbiAgICAgICAgaWYgKGV2dCkge1xuICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcmVmID0gdHJpZ2dlci5nZXRBdHRyaWJ1dGUoJ2RhdGEtbW9kYWwtaWQnKTtcblxuICAgICAgICBpZiAocmVmICE9PSBudWxsKSB7XG4gICAgICAgICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjJHtyZWZ9YCk7XG4gICAgICAgICAgZm5PcGVuKG1vZGFsKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0gLy8gaWYgKG1vZGFsVHJpZ2dlcnMgIT09IG51bGwpXG5cbiAgbW9kYWxUcmlnZ2VycyA9IHVuZGVmaW5lZDtcblxuICByZXR1cm4ge1xuICAgIGdldDogKGlkeCkgPT4ge1xuICAgICAgaWYgKHR5cGVvZiBpZHggPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGxldCBtb2RhbCA9IGZhbHNlO1xuXG4gICAgICAgIG1vZGFscy5mb3JFYWNoKChub2RlKSA9PiB7XG4gICAgICAgICAgaWYgKG5vZGUuaWQgPT09IGlkeC5yZXBsYWNlKC9eIy8sICcnKSkge1xuICAgICAgICAgICAgbW9kYWwgPSBub2RlO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIG1vZGFsO1xuICAgICAgfVxuXG4gICAgICBpZiAodHlwZW9mIG1vZGFsc1tpZHhdICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICByZXR1cm4gbW9kYWxzW2lkeF07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH07XG59OyAvLyBzZWVkTW9kYWxcblxuaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSB7XG4gIG1vZHVsZS5leHBvcnRzLnNlZWRNb2RhbCA9IHNlZWRNb2RhbDtcbn0gZWxzZSB7XG4gIGlmICh0eXBlb2Ygd2luZG93LlNlZWRDU1MgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgd2luZG93LlNlZWRDU1MgPSB7fTtcbiAgfVxuXG4gIHdpbmRvdy5TZWVkQ1NTLm1vZGFsID0gc2VlZE1vZGFsO1xufVxuIiwiLyoqIVxuICogU2VlZC1DU1MgLSBPZmYtQ2FudmFzLlxuICogQGF1dGhvciBSb2dlcmlvIFRhcXVlcyAoaGVsbG9AYWJ0ei5jbylcbiAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL0FidHpMYWJzL3NlZWQtY3NzXG4gKiBAdmVyc2lvbiAyLjIuMFxuICogQGxpY2Vuc2UgTUlUXG4gKi9cblxuY29uc3Qgc2VlZE9mZkNhbnZhcyA9IGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGNvbnN0IGZuVG9nZ2xlID0gKGNhbnZhc0lELCB0cmlnZ2VyRWxlbWVudCkgPT4ge1xuICAgIGxldCBjdXN0b21FdmVudDtcblxuICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2NhbnZhc0lELnJlcGxhY2UoL14jLywgJycpfWApO1xuXG4gICAgY29uc3QgdHJpZ2dlciA9XG4gICAgICB0cmlnZ2VyRWxlbWVudCB8fFxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgYFtyb2xlPVwib2ZmY2FudmFzXCJdW2RhdGEtaWQ9XCIke2NhbnZhc0lELnJlcGxhY2UoL14jLywgJycpfVwiXWBcbiAgICAgICk7XG5cbiAgICBpZiAoY2FudmFzICE9PSBudWxsKSB7XG4gICAgICBjYW52YXMuY2xhc3NMaXN0LnRvZ2dsZSgnb3BlbicpO1xuXG4gICAgICAvLyBQcmV2ZW50cyBzY3JvbGxpbmcgdGhlIEhUTUxcbiAgICAgIGlmIChjYW52YXMuY2xhc3NMaXN0LmNvbnRhaW5zKCdvcGVuJykpIHtcbiAgICAgICAgaWYgKHRyaWdnZXIgIT09IG51bGwpIHtcbiAgICAgICAgICAvLyBBZGQgdGhlICd0cmlnZ2VyZWQnIGNsYXNzIHRvIHRoZSBlbGVtZW50IHdoaWNoIGhhcyB0cmlnZ2VyZWQgdGhlIG9mZmNhbnZhcy5cbiAgICAgICAgICB0cmlnZ2VyLmNsYXNzTGlzdC5hZGQoJ3RyaWdnZXJlZCcpO1xuICAgICAgICB9IC8vIGlmICh0cmlnZ2VyICE9PSBudWxsKVxuXG4gICAgICAgIC8vIFByZXZlbnRzIG1haW4gdG8gc2Nyb2xsXG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2h0bWwnKS5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gUmVtb3ZlIHRoZSAndHJpZ2dlcmVkJyBjbGFzcyBmb3IgYW55IGV4aXN0aW5nIHRyaWdnZXIgd2hpY2ggcmVmZXJzIGdpdmVuIG9mZmNhbnZhcy5cbiAgICAgICAgZG9jdW1lbnRcbiAgICAgICAgICAucXVlcnlTZWxlY3RvckFsbChcbiAgICAgICAgICAgIGBbcm9sZT1cIm9mZmNhbnZhc1wiXVtkYXRhLWlkPVwiJHtjYW52YXNJRC5yZXBsYWNlKC9eIy8sICcnKX1cIl1gXG4gICAgICAgICAgKVxuICAgICAgICAgIC5mb3JFYWNoKCh0Z3IpID0+IHtcbiAgICAgICAgICAgIHRnci5jbGFzc0xpc3QucmVtb3ZlKCd0cmlnZ2VyZWQnKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAvLyBSZS1lbmFibGVzIG1haW4gc2Nyb2xsaW5nXG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2h0bWwnKS5zdHlsZS5vdmVyZmxvdyA9ICcnO1xuICAgICAgfVxuXG4gICAgICAvLyBXYWl0IHVudGlsIGFuaW1hdGlvbiBpcyBjb21wbGV0ZSB0byBkaXNwYXRjaCB0aGUgZXZlbnRcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBpZiAoY2FudmFzLmNsYXNzTGlzdC5jb250YWlucygnb3BlbicpKSB7XG4gICAgICAgICAgY3VzdG9tRXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoJ2NhbnZhcy5vcGVuZWQnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjdXN0b21FdmVudCA9IG5ldyBDdXN0b21FdmVudCgnY2FudmFzLmNsb3NlZCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRGlzcGF0Y2ggdGhlICdjYW52YXMub3BlbmVkJy8gJ2NhbnZhcy5jbG9zZWQnIGV2ZW50c1xuICAgICAgICBjYW52YXMuZGlzcGF0Y2hFdmVudChjdXN0b21FdmVudCk7XG4gICAgICB9LCAzMDApO1xuICAgIH0gLy8gaWYgKGNhbnZhcyAhPT0gbnVsbClcbiAgfTsgLy8gZm5Ub2dnbGVcblxuICBjb25zdCBmblRyaWdnZXJDbGljayA9IChldnQpID0+IHtcbiAgICBpZiAoZXZ0KSB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG5cbiAgICBmblRvZ2dsZShcbiAgICAgIGV2dC5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1pZCcpIHx8ICdvZmZjYW52YXMnLFxuICAgICAgZXZ0LmN1cnJlbnRUYXJnZXRcbiAgICApO1xuICB9OyAvLyBmblRyaWdnZXJDbGlja1xuXG4gIC8vIEZpbmQgYWxsIGV4aXN0aW5nIHRyaWdnZXJzXG4gIGNvbnN0IHRyaWdnZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW3JvbGU9XCJvZmZjYW52YXNcIl0nKTtcblxuICAvLyBGaW5kIGFsbCBleGlzdGluZyBvZmZjYW52YXNcbiAgY29uc3QgY2FudmFzZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcub2ZmY2FudmFzJyk7XG5cbiAgaWYgKHRyaWdnZXJzICE9PSBudWxsKSB7XG4gICAgdHJpZ2dlcnMuZm9yRWFjaChmdW5jdGlvbiAodHJpZ2dlciwgaSkge1xuICAgICAgdHJpZ2dlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZuVHJpZ2dlckNsaWNrKTtcbiAgICB9KTsgLy8gdHJpZ2dlcnMuZm9yRWFjaChmdW5jdGlvbih0cmlnZ2VyLCBpKVxuICB9IC8vIGlmICh0cmlnZ2VycyAhPT0gbnVsbClcblxuICBpZiAoY2FudmFzZXMgIT09IG51bGwpIHtcbiAgICBjYW52YXNlcy5mb3JFYWNoKChjYW52YXMsIGkpID0+IHtcbiAgICAgIC8vIEF0dGFjaCBtZXRob2QgZm9yIG9wZW5pbmdcbiAgICAgIGNhbnZhcy5vcGVuID0gKCkgPT4ge1xuICAgICAgICBmblRvZ2dsZShjYW52YXMuZ2V0QXR0cmlidXRlKCdpZCcpIHx8ICdvZmZjYW52YXMnKTtcbiAgICAgIH07IC8vIG9wZW5cblxuICAgICAgLy8gQXR0YWNoIG1ldGhvZCBmb3IgY2xvc2luZ1xuICAgICAgY2FudmFzLmNsb3NlID0gKCkgPT4geyB9OyAvLyBjbG9zZVxuICAgIH0pOyAvLyBjYW52YXNlcy5mb3JFYWNoKChjYW52YXMsIGkpXG4gIH0gLy8gaWYgKGNhbnZhc2VzICE9PSBudWxsKVxuXG4gIHJldHVybiB7XG4gICAgZ2V0OiAoaWR4KSA9PiB7XG4gICAgICBpZiAodHlwZW9mIGlkeCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgbGV0IGNhbnZhcyA9IGZhbHNlO1xuXG4gICAgICAgIGNhbnZhc2VzLmZvckVhY2goKG5vZGUpID0+IHtcbiAgICAgICAgICBpZiAobm9kZS5pZCA9PT0gaWR4LnJlcGxhY2UoL14jLywgJycpKSB7XG4gICAgICAgICAgICBjYW52YXMgPSBub2RlO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIGNhbnZhcztcbiAgICAgIH1cblxuICAgICAgaWYgKHR5cGVvZiBjYW52YXNbaWR4XSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcmV0dXJuIGNhbnZhc1tpZHhdO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9O1xufTsgLy8gc2VlZE9mZkNhbnZhc1xuXG5pZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgbW9kdWxlLmV4cG9ydHMuc2VlZE9mZkNhbnZhcyA9IHNlZWRPZmZDYW52YXM7XG59IGVsc2Uge1xuICBpZiAodHlwZW9mIHdpbmRvdy5TZWVkQ1NTID09PSAndW5kZWZpbmVkJykge1xuICAgIHdpbmRvdy5TZWVkQ1NTID0ge307XG4gIH1cblxuICB3aW5kb3cuU2VlZENTUy5vZmZDYW52YXMgPSBzZWVkT2ZmQ2FudmFzO1xufVxuIiwiLyoqIVxuICogU2VlZC1DU1MgLSBTY3JvbGwuXG4gKiBAYXV0aG9yIFJvZ2VyaW8gVGFxdWVzIChoZWxsb0BhYnR6LmNvKVxuICogQHNlZSBodHRwczovL2dpdGh1Yi5jb20vQWJ0ekxhYnMvc2VlZC1jc3NcbiAqIEB2ZXJzaW9uIDIuMi4wXG4gKiBAbGljZW5zZSBNSVRcbiAqL1xuXG5jb25zdCBzZWVkU2Nyb2xsID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGxldCB0cmlnZ2VycyA9IG51bGw7XG5cbiAgbGV0IHJldmVhbGVycyA9IG51bGw7XG5cbiAgbGV0IHNjcm9sbFRhcmdldCA9IDA7XG5cbiAgY29uc3QgZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgc3B5U2Nyb2xsU2VsZWN0b3I6ICduYXYgYS5zbW9vdGgnLFxuICAgIHJldmVhbEVsZW1lbnRTZWxlY3RvcjogJy5yZXZlYWwnLFxuICAgIHJldmVhbFNwYWNlT2Zmc2V0OiAwLjIsXG4gICAgcmV2ZWFsV2hlblZpc2libGU6ICd2aXNpYmxlJyxcbiAgICByZXZlYWxTaW5nbGVBbmltYXRpb246ICd2aXNpYmxlLW9uY2UnLFxuICAgIHJldmVhbFdoZW5IaWRkZW46ICdoaWRkZW4nLFxuICAgIGd1dHRlcjogNTBcbiAgfTsgLy8gZGVmYXVsdE9wdGlvbnNcblxuICBjb25zdCBmblVwZGF0ZUFjdGl2ZVRyaWdnZXIgPSAoZWxlbSkgPT4ge1xuICAgIHRyaWdnZXJzLmZvckVhY2goKGVsKSA9PiB7XG4gICAgICBlbC5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcbiAgICB9KTtcblxuICAgIGlmIChlbGVtKSB7XG4gICAgICBlbGVtLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuICAgIH1cbiAgfTsgLy8gZm5VcGRhdGVBY3RpdmVUcmlnZ2VyXG5cbiAgY29uc3QgZm5HZXRPZmZzZXQgPSAoZWxlbSkgPT4ge1xuICAgIGNvbnN0IGJvZHlPZmZzZXQgPSBkb2N1bWVudC5ib2R5LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIGNvbnN0IG9mZnNldCA9IGVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdG9wOiBNYXRoLmNlaWwob2Zmc2V0LnRvcCAtIGJvZHlPZmZzZXQudG9wKSxcbiAgICAgIGxlZnQ6IE1hdGguY2VpbChvZmZzZXQubGVmdCAtIGJvZHlPZmZzZXQubGVmdClcbiAgICB9O1xuICB9OyAvLyBmbkdldE9mZnNldFxuXG4gIGNvbnN0IGZuU2Nyb2xsQ29tcGxldGUgPSAoZXZ0KSA9PiB7XG4gICAgaWYgKHdpbmRvdy5zY3JvbGxZID09PSBzY3JvbGxUYXJnZXQpIHtcbiAgICAgIGNvbnN0IHNlZWRDdXN0b21FdmVudCA9IG5ldyBDdXN0b21FdmVudCgnc2Nyb2xsLmNvbXBsZXRlJyk7XG4gICAgICBkb2N1bWVudC5kaXNwYXRjaEV2ZW50KHNlZWRDdXN0b21FdmVudCk7XG4gICAgfVxuXG4gICAgaWYgKHRyaWdnZXJzKSB7XG4gICAgICBjb25zdCBmaXJzdEVsZW1lbnRPZmZzZXQgPSBmbkdldE9mZnNldCh0cmlnZ2Vyc1swXSk7XG5cbiAgICAgIGlmICh3aW5kb3cuc2Nyb2xsWSA8IGZpcnN0RWxlbWVudE9mZnNldC50b3ApIHtcbiAgICAgICAgZm5VcGRhdGVBY3RpdmVUcmlnZ2VyKCk7XG4gICAgICB9XG5cbiAgICAgIHRyaWdnZXJzLmZvckVhY2goKGVsLCBpKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgdGFyZ2V0SUQgPVxuICAgICAgICAgICAgZWwuZ2V0QXR0cmlidXRlKCdocmVmJykgfHwgZWwuZ2V0QXR0cmlidXRlKCdkYXRhLXRhcmdldCcpO1xuXG4gICAgICAgICAgY29uc3QgdGFyZ2V0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0YXJnZXRJRCk7XG4gICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gZm5HZXRPZmZzZXQodGFyZ2V0KTtcblxuICAgICAgICAgIGlmIChvZmZzZXQudG9wIC0gb3B0aW9ucy5ndXR0ZXIgPD0gd2luZG93LnNjcm9sbFkpIHtcbiAgICAgICAgICAgIGZuVXBkYXRlQWN0aXZlVHJpZ2dlcihlbCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlKSB7IH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2Ygd2luZG93Lm9sZE9uc2Nyb2xsID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICB3aW5kb3cub2xkT25zY3JvbGwoZXZ0KTtcbiAgICB9XG4gIH07IC8vIGZuU2Nyb2xsQ29tcGxldGVcblxuICBjb25zdCBmblRyaWdnZXJDbGljayA9IChldnQpID0+IHtcbiAgICBpZiAoZXZ0KSB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG5cbiAgICBjb25zdCB0YXJnZXQgPVxuICAgICAgZXZ0LmN1cnJlbnRUYXJnZXQuZ2V0QXR0cmlidXRlKCdocmVmJykgfHxcbiAgICAgIGV2dC5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS10YXJnZXQnKTtcblxuICAgIGlmICh0YXJnZXQpIHtcbiAgICAgIGNvbnN0IGVsZW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRhcmdldCk7XG5cbiAgICAgIHNjcm9sbFRhcmdldCA9IGZuR2V0T2Zmc2V0KGVsZW0pLnRvcCAtIG9wdGlvbnMuZ3V0dGVyOyAvLyBhZGQgc29tZSBndXR0ZXJcblxuICAgICAgd2luZG93LnNjcm9sbFRvKHtcbiAgICAgICAgYmVoYXZpb3I6ICdzbW9vdGgnLFxuICAgICAgICBsZWZ0OiAwLFxuICAgICAgICB0b3A6IHNjcm9sbFRhcmdldFxuICAgICAgfSk7XG4gICAgfVxuICB9OyAvLyBmblRyaWdnZXJDbGlja1xuXG4gIGNvbnN0IGZuV2F0Y2hFbGVtZW50cyA9ICgpID0+IHtcbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIHZpZXdwb3J0ICh3aW5kb3cpIGRpbWVuc2lvbnMuXG4gICAgICogQHJldHVybiBvYmplY3RcbiAgICAgKi9cbiAgICBjb25zdCBnZXRWaWV3cG9ydFNpemUgPSAoKSA9PiB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB3aWR0aDogd2luZG93LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCxcbiAgICAgICAgaGVpZ2h0OiB3aW5kb3cuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodFxuICAgICAgfTtcbiAgICB9OyAvLyBnZXRWaWV3cG9ydFNpemVcblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgY3VycmVudCBzY29sbCBwb3NpdGlvbi5cbiAgICAgKiBAcmV0dXJuIG9iamVjdFxuICAgICAqL1xuICAgIGNvbnN0IGdldEN1cnJlbnRTY3JvbGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB4OiB3aW5kb3cucGFnZVhPZmZzZXQsXG4gICAgICAgIHk6IHdpbmRvdy5wYWdlWU9mZnNldFxuICAgICAgfTtcbiAgICB9OyAvLyBnZXRDdXJyZW50U2Nyb2xsXG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBlbGVtZW50IGRpbWVuc2lvbiBhbmQgcG9zaXRpb24uXG4gICAgICogQHBhcmFtIEhUTUxFbGVtZW50IGVsXG4gICAgICogQHJldHVybiBvYmplY3RcbiAgICAgKi9cbiAgICBjb25zdCBnZXRFbGVtSW5mbyA9IChlbCkgPT4ge1xuICAgICAgbGV0IGVsZW0gPSBlbDtcbiAgICAgIGxldCBvZmZzZXRUb3AgPSAwO1xuICAgICAgbGV0IG9mZnNldExlZnQgPSAwO1xuICAgICAgY29uc3Qgb2Zmc2V0V2lkdGggPSBlbGVtLm9mZnNldFdpZHRoO1xuICAgICAgY29uc3Qgb2Zmc2V0SGVpZ2h0ID0gZWxlbS5vZmZzZXRIZWlnaHQ7XG5cbiAgICAgIGRvIHtcbiAgICAgICAgaWYgKCFpc05hTihlbGVtLm9mZnNldFRvcCkpIHtcbiAgICAgICAgICBvZmZzZXRUb3AgKz0gZWxlbS5vZmZzZXRUb3A7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWlzTmFOKGVsZW0ub2Zmc2V0TGVmdCkpIHtcbiAgICAgICAgICBvZmZzZXRMZWZ0ICs9IGVsZW0ub2Zmc2V0TGVmdDtcbiAgICAgICAgfVxuICAgICAgfSB3aGlsZSAoKGVsZW0gPSBlbGVtLm9mZnNldFBhcmVudCkgIT09IG51bGwpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB0b3A6IG9mZnNldFRvcCxcbiAgICAgICAgbGVmdDogb2Zmc2V0TGVmdCxcbiAgICAgICAgaGVpZ2h0OiBvZmZzZXRIZWlnaHQsXG4gICAgICAgIHdpZHRoOiBvZmZzZXRXaWR0aFxuICAgICAgfTtcbiAgICB9OyAvLyBnZXRFbGVtSW5mb1xuXG4gICAgLyoqXG4gICAgICogSWRlbnRpZmllcyB3aGV0aGVyIHRoZSBlbGVtZW50IGlzIHZpc2libGUgaW4gdGhlIHZpZXdwb3J0LlxuICAgICAqIEBwYXJhbSBIVE1MRWxlbWVudCBlbGVtXG4gICAgICogQHJldHVybiBib29sZWFuXG4gICAgICovXG4gICAgY29uc3QgaXNFbGVtZW50VmlzaWJsZSA9IChlbGVtKSA9PiB7XG4gICAgICBjb25zdCB2aWV3cG9ydFNpemUgPSBnZXRWaWV3cG9ydFNpemUoKTtcbiAgICAgIGNvbnN0IGN1cnJlbnRTY3JvbGwgPSBnZXRDdXJyZW50U2Nyb2xsKCk7XG4gICAgICBjb25zdCBlSW5mID0gZ2V0RWxlbUluZm8oZWxlbSk7XG4gICAgICBjb25zdCBzcGFjZU9mZnNldCA9IG9wdGlvbnMucmV2ZWFsU3BhY2VPZmZzZXQ7XG5cbiAgICAgIGNvbnN0IGNoZWNrQm91bmRhcmllcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gVGhlIGVsZW1lbnQgYm91bmRhcmllc1xuICAgICAgICBjb25zdCBlVG9wID0gZUluZi50b3AgKyBlSW5mLmhlaWdodCAqIHNwYWNlT2Zmc2V0O1xuICAgICAgICBjb25zdCBlTGVmdCA9IGVJbmYubGVmdCArIGVJbmYud2lkdGggKiBzcGFjZU9mZnNldDtcbiAgICAgICAgY29uc3QgZVJpZ2h0ID0gZUluZi5sZWZ0ICsgZUluZi53aWR0aCAtIGVJbmYud2lkdGggKiBzcGFjZU9mZnNldDtcbiAgICAgICAgY29uc3QgZUJvdHRvbSA9IGVJbmYudG9wICsgZUluZi5oZWlnaHQgLSBlSW5mLmhlaWdodCAqIHNwYWNlT2Zmc2V0O1xuXG4gICAgICAgIC8vIFRoZSB3aW5kb3cgYm91bmRhcmllc1xuICAgICAgICBjb25zdCB3VG9wID0gY3VycmVudFNjcm9sbC55ICsgMDtcbiAgICAgICAgY29uc3Qgd0xlZnQgPSBjdXJyZW50U2Nyb2xsLnggKyAwO1xuICAgICAgICBjb25zdCB3Qm90dG9tID0gY3VycmVudFNjcm9sbC55IC0gMCArIHZpZXdwb3J0U2l6ZS5oZWlnaHQ7XG4gICAgICAgIGNvbnN0IHdSaWdodCA9IGN1cnJlbnRTY3JvbGwueCAtIDAgKyB2aWV3cG9ydFNpemUud2lkdGg7XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGVsZW1lbnQgaXMgd2l0aGluIGJvdW5kYXJ5XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgZVRvcCA8IHdCb3R0b20gJiYgZUJvdHRvbSA+IHdUb3AgJiYgZUxlZnQgPiB3TGVmdCAmJiBlUmlnaHQgPCB3UmlnaHRcbiAgICAgICAgKTtcbiAgICAgIH07XG5cbiAgICAgIHJldHVybiBjaGVja0JvdW5kYXJpZXMoKTtcbiAgICB9OyAvLyBpc0VsZW1lbnRWaXNpYmxlXG5cbiAgICAvKipcbiAgICAgKiBXYXRjaCB0aGUgdGFyZ2V0IGVsZW1lbnRzIHdpdGggYSBsb29wIHRvIGlkZW50aWZ5IHdoaWNoIG9uZSBpcyBpbnNpZGUgdGhlIHZpZXdwb3J0LlxuICAgICAqIElmIGZvdW5kLCB0aGUgZWxlbWVudCBnZXRzIGEgY2xhc3MgZGVmaW5lZCBpbiB0aGUgb3B0aW9ucy5cbiAgICAgKiBAcmV0dXJuIHZvaWRcbiAgICAgKi9cbiAgICBjb25zdCB0b2dnbGVFbGVtZW50ID0gKCkgPT4ge1xuICAgICAgaWYgKCFyZXZlYWxlcnMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJldmVhbGVycy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICBpZiAoaXNFbGVtZW50VmlzaWJsZShyZXZlYWxlcnNbaV0pKSB7XG4gICAgICAgICAgaWYgKG9wdGlvbnMucmV2ZWFsV2hlblZpc2libGUpIHtcbiAgICAgICAgICAgIHJldmVhbGVyc1tpXS5jbGFzc0xpc3QuYWRkKG9wdGlvbnMucmV2ZWFsV2hlblZpc2libGUpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChvcHRpb25zLnJldmVhbFdoZW5IaWRkZW4pIHtcbiAgICAgICAgICAgIHJldmVhbGVyc1tpXS5jbGFzc0xpc3QucmVtb3ZlKG9wdGlvbnMucmV2ZWFsV2hlbkhpZGRlbik7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIHJldmVhbGVyc1tpXS5jbGFzc0xpc3QuY29udGFpbnMob3B0aW9ucy5yZXZlYWxTaW5nbGVBbmltYXRpb24pID09PVxuICAgICAgICAgICAgZmFsc2VcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnJldmVhbFdoZW5IaWRkZW4pIHtcbiAgICAgICAgICAgICAgcmV2ZWFsZXJzW2ldLmNsYXNzTGlzdC5hZGQob3B0aW9ucy5yZXZlYWxXaGVuSGlkZGVuKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG9wdGlvbnMucmV2ZWFsV2hlblZpc2libGUpIHtcbiAgICAgICAgICAgICAgcmV2ZWFsZXJzW2ldLmNsYXNzTGlzdC5yZW1vdmUob3B0aW9ucy5yZXZlYWxXaGVuVmlzaWJsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfTsgLy8gdG9nZ2xlRWxlbWVudFxuXG4gICAgLyoqXG4gICAgICogQSBoYW5kbGVyIGZvciBzY3JvbGxpbmcgYW5kIHJlc2l6aW5nXG4gICAgICogQHBhcmFtIHdpbmRvdy5FdmVudCBldnRcbiAgICAgKiBAcmV0dXJuIHZvaWRcbiAgICAgKi9cbiAgICBjb25zdCBzY3JvbGxSZXNpemVIYW5kbGVyID0gKGV2dCkgPT4ge1xuICAgICAgdG9nZ2xlRWxlbWVudCgpO1xuICAgIH07XG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgc2Nyb2xsUmVzaXplSGFuZGxlciwgZmFsc2UpO1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBzY3JvbGxSZXNpemVIYW5kbGVyLCBmYWxzZSk7XG4gIH07IC8vIGZuV2F0Y2hFbGVtZW50c1xuXG4gIHdpbmRvdy5vbGRPbnNjcm9sbCA9IHdpbmRvdy5vbnNjcm9sbDtcbiAgd2luZG93Lm9uc2Nyb2xsID0gZm5TY3JvbGxDb21wbGV0ZTtcblxuICBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xuXG4gIC8vIEZpbmQgYWxsIGV4aXN0aW5nIHRyaWdnZXJzIGZvciBzbW9vdGggc2Nyb2xsaW5nXG4gIHRyaWdnZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChvcHRpb25zLnNweVNjcm9sbFNlbGVjdG9yKTtcblxuICAvLyBGaW5kIGFsbCBleGlzdGluZyB0YXJnZXRzIGZvciB3YXRjaGluZyB0aGUgdmlld3BvcnRcbiAgcmV2ZWFsZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChvcHRpb25zLnJldmVhbEVsZW1lbnRTZWxlY3Rvcik7XG5cbiAgaWYgKHRyaWdnZXJzICE9PSBudWxsKSB7XG4gICAgdHJpZ2dlcnMuZm9yRWFjaChmdW5jdGlvbiAodHJpZ2dlciwgaSkge1xuICAgICAgdHJpZ2dlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZuVHJpZ2dlckNsaWNrKTtcbiAgICB9KTsgLy8gdHJpZ2dlcnMuZm9yRWFjaChmdW5jdGlvbih0cmlnZ2VyLCBpKVxuICB9IC8vIGlmICh0cmlnZ2VycyAhPT0gbnVsbClcblxuICBpZiAocmV2ZWFsZXJzKSB7XG4gICAgZm5XYXRjaEVsZW1lbnRzKCk7XG4gIH1cblxuICByZXR1cm4ge307XG59OyAvLyBzZWVkU2Nyb2xsXG5cbmlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykge1xuICBtb2R1bGUuZXhwb3J0cy5zZWVkU2Nyb2xsID0gc2VlZFNjcm9sbDtcbn0gZWxzZSB7XG4gIGlmICh0eXBlb2Ygd2luZG93LlNlZWRDU1MgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgd2luZG93LlNlZWRDU1MgPSB7fTtcbiAgfVxuXG4gIHdpbmRvdy5TZWVkQ1NTLnNjcm9sbCA9IHNlZWRTY3JvbGw7XG59XG4iLCIvKiohXG4gKiBTZWVkLUNTUyAtIEFkZGl0aW9uYWwgZmVhdHVyZXMgZm9yIEhUTUwgVGV4dGFyZWFzLlxuICogQGF1dGhvciBSb2dlcmlvIFRhcXVlcyAoaGVsbG9AYWJ0ei5jbylcbiAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL0FidHpMYWJzL3NlZWQtY3NzXG4gKiBAdmVyc2lvbiAyLjIuMFxuICogQGxpY2Vuc2UgTUlUXG4gKi9cblxuY29uc3Qgc2VlZFRleHRhcmVhID0gZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgLy8gRmluZCBhbGwgc2VlZC1maWxlIGlucHV0cy5cbiAgY29uc3QgaW5wdXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZpZWxkID4gdGV4dGFyZWEnKTtcblxuICBpZiAoaW5wdXRzICE9PSBudWxsKSB7XG4gICAgaW5wdXRzLmZvckVhY2goZnVuY3Rpb24gKGlucHV0LCBpKSB7XG4gICAgICBsZXQgbWF4TGVuZ3RoID0gMDtcblxuICAgICAgY29uc3QgcGFyZW50ID0gaW5wdXQucGFyZW50Tm9kZTtcbiAgICAgIGNvbnN0IGNvdW50ZXJMYWJlbCA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKCdbcm9sZT1cImNvdW50ZXJcIl0nKTtcbiAgICAgIGNvbnN0IHRlbXBsYXRlID1cbiAgICAgICAgY291bnRlckxhYmVsLmdldEF0dHJpYnV0ZSgnZGF0YS10ZW1wbGF0ZScpIHx8XG4gICAgICAgICdUeXBlZCAlYSBvdXQgb2YgJWIuIFJlbWFpbmluZyAlYy4nO1xuXG4gICAgICBjb25zdCBmbkNhbGMgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHR5cGVkID0gaW5wdXQudmFsdWUucmVwbGFjZSgvW1xcblxccl0vZywgJycpLmxlbmd0aDtcbiAgICAgICAgY29uc3QgcmVtYWluaW5nID0gbWF4TGVuZ3RoIC0gdHlwZWQ7XG4gICAgICAgIGNvbnN0IG1pbkxlbmd0aCA9IE1hdGguZmxvb3IobWF4TGVuZ3RoICogMC4xKTtcblxuICAgICAgICBjb3VudGVyTGFiZWwuaW5uZXJIVE1MID0gdGVtcGxhdGVcbiAgICAgICAgICAucmVwbGFjZSgnJWEnLCB0eXBlZClcbiAgICAgICAgICAucmVwbGFjZSgnJWInLCBtYXhMZW5ndGgpXG4gICAgICAgICAgLnJlcGxhY2UoXG4gICAgICAgICAgICAnJWMnLFxuICAgICAgICAgICAgcmVtYWluaW5nIDw9IG1pbkxlbmd0aFxuICAgICAgICAgICAgICA/IGA8c3BhbiBjbGFzcz1cInJlZFwiID4ke3JlbWFpbmluZ308L3NwYW4+YFxuICAgICAgICAgICAgICA6IHJlbWFpbmluZ1xuICAgICAgICAgICk7XG4gICAgICB9O1xuXG4gICAgICBtYXhMZW5ndGggPSBpbnB1dC5nZXRBdHRyaWJ1dGUoJ21heGxlbmd0aCcpO1xuXG4gICAgICAvLyBJZ25vcmUgaWYgbWF4bGVuZ3RoIGlzIG5vdCBnaXZlblxuICAgICAgaWYgKCFtYXhMZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBNYWtlIHN1cmUgdGhlIGxpbWl0IGlzIGFuIGludGVnZXJcbiAgICAgIG1heExlbmd0aCA9IHBhcnNlSW50KG1heExlbmd0aCk7XG5cbiAgICAgIC8vIEF0dGFjaCB0aGUgaGFuZGxlcnNcbiAgICAgICdrZXlwcmVzcyBrZXlkb3duIGtleXVwJy5zcGxpdCgnICcpLmZvckVhY2goKGV2dCkgPT4ge1xuICAgICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKGV2dCwgZm5DYWxjLCB0cnVlKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBJbml0aWFsaXplIHRoZSB1dGlsaXR5IGxhYmVsXG4gICAgICBmbkNhbGMoKTtcbiAgICB9KTsgLy8gaW5wdXRzLmZvckVhY2goZnVuY3Rpb24oaW5wdXQsIGkpXG4gIH0gLy8gaWYgKGlucHV0cyAhPT0gbnVsbClcbn07IC8vIHNlZWRUZXh0YXJlYVxuXG5pZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgbW9kdWxlLmV4cG9ydHMuc2VlZFRleHRhcmVhID0gc2VlZFRleHRhcmVhO1xufSBlbHNlIHtcbiAgaWYgKHR5cGVvZiB3aW5kb3cuU2VlZENTUyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICB3aW5kb3cuU2VlZENTUyA9IHt9O1xuICB9XG5cbiAgd2luZG93LlNlZWRDU1MudGV4dEFyZWEgPSBzZWVkVGV4dGFyZWE7XG59XG5cbiJdfQ==
